# PDFåˆ—è¡¨ç­›é€‰ç³»ç»Ÿè§„æ ¼è¯´æ˜

**åŠŸèƒ½ID**: 20251002005635-pdf-list-filter-system
**ä¼˜å…ˆçº§**: é«˜
**ç‰ˆæœ¬**: v001
**åˆ›å»ºæ—¶é—´**: 2025-10-02 00:56:35
**é¢„è®¡å®Œæˆ**: 2025-10-06
**çŠ¶æ€**: è®¾è®¡ä¸­

## ç°çŠ¶è¯´æ˜

### å½“å‰æœç´¢èƒ½åŠ›
- PDF-Home æ¨¡å—ä½¿ç”¨ Tabulator è¡¨æ ¼å±•ç¤ºè®°å½•
- Tabulator æä¾›åŸºç¡€çš„åˆ—å¤´ç­›é€‰åŠŸèƒ½ï¼ˆç‚¹å‡»åˆ—å¤´å›¾æ ‡ï¼‰
- ç¼ºå°‘ç»Ÿä¸€çš„å…¨å±€ç­›é€‰å…¥å£
- ä¸æ”¯æŒå¤æ‚çš„ç»„åˆæ¡ä»¶
- ä¸æ”¯æŒè·¨å­—æ®µçš„æ¨¡ç³Šæœç´¢

### ç”¨æˆ·éœ€æ±‚åœºæ™¯
- **åœºæ™¯1**: å¿«é€ŸæŸ¥æ‰¾ - "æˆ‘æƒ³æ‰¾åŒ…å«'Python'å…³é”®è¯çš„PDF"
- **åœºæ™¯2**: ç²¾ç¡®ç­›é€‰ - "æˆ‘æƒ³æ‰¾è¯„åˆ†â‰¥4æ˜Ÿä¸”å¤ä¹ æ¬¡æ•°>10çš„PDF"
- **åœºæ™¯3**: å¤æ‚ç»„åˆ - "æˆ‘æƒ³æ‰¾(æ ‡ç­¾åŒ…å«'æ•™ç¨‹' æˆ– æ–‡ä»¶ååŒ…å«'tutorial') ä¸” åˆ›å»ºæ—¶é—´åœ¨æœ€è¿‘7å¤©å†…çš„PDF"
- **åœºæ™¯4**: æ¨¡ç³Šæœç´¢ - "æˆ‘è®°å¾—æœ‰ä¸ªå…³äº'æœºå™¨å­¦ä¹ 'çš„PDFï¼Œä½†ä¸è®°å¾—å…·ä½“å­—æ®µ"

## å­˜åœ¨é—®é¢˜

### åŠŸèƒ½å±€é™æ€§
- **ç¼ºå°‘å…¨å±€æœç´¢**: æ²¡æœ‰ç»Ÿä¸€çš„æœç´¢æ¡†ï¼Œç”¨æˆ·æ‰¾ä¸åˆ°ç­›é€‰å…¥å£
- **ä¸æ”¯æŒé€»è¾‘ç»„åˆ**: æ— æ³•å®ç°"æ—¢æ»¡è¶³Aæ¡ä»¶åˆæ»¡è¶³Bæ¡ä»¶"çš„ç­›é€‰
- **ä¸æ”¯æŒè·¨å­—æ®µæœç´¢**: æ— æ³•åŒæ—¶åœ¨å¤šä¸ªå­—æ®µä¸­æŸ¥æ‰¾å…³é”®è¯
- **ä¸æ”¯æŒé«˜çº§æ“ä½œç¬¦**: æ— æ³•ä½¿ç”¨ >, <, â‰¥, â‰¤, !=, åŒ…å«, ä¸åŒ…å«ç­‰æ“ä½œ
- **ç¼ºå°‘ç­›é€‰å†å²**: æ— æ³•ä¿å­˜å¸¸ç”¨çš„ç­›é€‰æ¡ä»¶

### ç”¨æˆ·ä½“éªŒé—®é¢˜
- ç­›é€‰æ“ä½œå¤æ‚ï¼Œéœ€è¦é€åˆ—è®¾ç½®
- æ— æ³•å¿«é€Ÿæ¸…é™¤æ‰€æœ‰ç­›é€‰æ¡ä»¶
- ä¸çŸ¥é“å½“å‰åº”ç”¨äº†å“ªäº›ç­›é€‰æ¡ä»¶
- å¤§æ•°æ®é‡æ—¶ç­›é€‰æ€§èƒ½å¯èƒ½è¾ƒå·®

### æ‰©å±•æ€§é—®é¢˜
- ç­›é€‰é€»è¾‘ä¸UIç»„ä»¶è€¦åˆ
- éš¾ä»¥æ”¯æŒè‡ªå®šä¹‰ç­›é€‰è§„åˆ™
- æ— æ³•æ”¯æŒåç«¯ç­›é€‰ï¼ˆæœåŠ¡ç«¯åˆ†é¡µï¼‰

## æå‡ºéœ€æ±‚

### æ ¸å¿ƒåŠŸèƒ½ï¼ˆv001 åŸºç¡€ç‰ˆï¼‰

#### 1. å…¨å±€ç­›é€‰æœç´¢æ¡†
- **ä½ç½®**: PDFåˆ—è¡¨é¡¶éƒ¨å·¥å…·æ 
- **åŠŸèƒ½**: æ”¯æŒå¿«é€Ÿæœç´¢å’Œé«˜çº§ç­›é€‰
- **æ¨¡å¼åˆ‡æ¢**:
  - ç®€å•æ¨¡å¼ï¼šå•ä¸€æœç´¢æ¡†ï¼Œæ¨¡ç³Šæœç´¢
  - é«˜çº§æ¨¡å¼ï¼šæ¡ä»¶æ„å»ºå™¨ï¼Œæ”¯æŒå¤æ‚é€»è¾‘

#### 2. æ¨¡ç³Šæœç´¢ï¼ˆå…¨å­—æ®µï¼‰
- åœ¨æ‰€æœ‰å¯æœç´¢å­—æ®µä¸­æŸ¥æ‰¾å…³é”®è¯
- æ”¯æŒå¤šå…³é”®è¯ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰
- é«˜äº®åŒ¹é…ç»“æœ
- å®æ—¶æœç´¢ï¼ˆè¾“å…¥æ—¶å»¶è¿Ÿ300msè§¦å‘ï¼‰

#### 3. ç²¾ç¡®ç­›é€‰ï¼ˆå•å­—æ®µï¼‰
- æŒ‰æŒ‡å®šå­—æ®µç­›é€‰
- æ”¯æŒä¸åŒæ•°æ®ç±»å‹çš„æ“ä½œç¬¦ï¼š
  - **å­—ç¬¦ä¸²**: ç­‰äºã€åŒ…å«ã€ä¸åŒ…å«ã€å¼€å¤´æ˜¯ã€ç»“å°¾æ˜¯
  - **æ•°å­—**: ç­‰äºã€ä¸ç­‰äºã€å¤§äºã€å°äºã€å¤§äºç­‰äºã€å°äºç­‰äºã€èŒƒå›´
  - **æ—¥æœŸ**: ç­‰äºã€ä¹‹å‰ã€ä¹‹åã€èŒƒå›´ã€ç›¸å¯¹æ—¶é—´ï¼ˆä»Šå¤©ã€æ˜¨å¤©ã€æœ€è¿‘7å¤©ï¼‰
  - **æ ‡ç­¾**: åŒ…å«ä»»ä¸€ã€åŒ…å«å…¨éƒ¨ã€ä¸åŒ…å«
  - **è¯„åˆ†**: ç­‰äºã€å¤§äºç­‰äºã€å°äºç­‰äº

#### 4. é€»è¾‘ç»„åˆç­›é€‰
- æ”¯æŒ ANDï¼ˆä¸ï¼‰ã€ORï¼ˆæˆ–ï¼‰ã€NOTï¼ˆéï¼‰é€»è¾‘
- æ”¯æŒæ¡ä»¶åˆ†ç»„ï¼ˆæ‹¬å·ï¼‰
- å¯è§†åŒ–æ¡ä»¶æ„å»ºå™¨
- æ¡ä»¶ä¼˜å…ˆçº§æ˜ç¡®

#### 5. ç­›é€‰çŠ¶æ€ç®¡ç†
- æ˜¾ç¤ºå½“å‰æ´»è·ƒçš„ç­›é€‰æ¡ä»¶
- æ”¯æŒå¿«é€Ÿæ¸…é™¤å•ä¸ªæ¡ä»¶
- æ”¯æŒä¸€é”®æ¸…é™¤æ‰€æœ‰æ¡ä»¶
- æ˜¾ç¤ºç­›é€‰ç»“æœæ•°é‡

### æœªæ¥æ‰©å±•é¢„ç•™ï¼ˆv002+ï¼‰
- ç­›é€‰æ¨¡æ¿ä¿å­˜å’ŒåŠ è½½
- æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒ
- è‡ªå®šä¹‰ç­›é€‰å‡½æ•°
- åç«¯ç­›é€‰æ”¯æŒï¼ˆæœåŠ¡ç«¯åˆ†é¡µï¼‰
- ç­›é€‰ç»“æœå¯¼å‡º
- æ™ºèƒ½ç­›é€‰å»ºè®®ï¼ˆåŸºäºå†å²ï¼‰

## è§£å†³æ–¹æ¡ˆ

### æŠ€æœ¯æ¶æ„è®¾è®¡

#### 1. åˆ†å±‚æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UI Layer (FilterSearchBar + FilterBuilder)    â”‚  â† ç”¨æˆ·äº¤äº’å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Manager Layer (FilterManager)                  â”‚  â† ä¸šåŠ¡åè°ƒå±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Condition Layer (FilterCondition Interface)    â”‚  â† æ¡ä»¶æŠ½è±¡å±‚
â”‚  â”œâ”€â”€ FieldCondition (å­—æ®µç­›é€‰)                  â”‚
â”‚  â”œâ”€â”€ FuzzySearchCondition (æ¨¡ç³Šæœç´¢)            â”‚
â”‚  â””â”€â”€ CompositeCondition (ç»„åˆæ¡ä»¶)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Executor Layer (FilterExecutor)                â”‚  â† æ‰§è¡Œå±‚
â”‚  â”œâ”€â”€ FrontendFilter (å‰ç«¯ç­›é€‰)                  â”‚
â”‚  â””â”€â”€ BackendFilter (åç«¯ç­›é€‰, v002+)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Event Layer (EventBus)                         â”‚  â† äº‹ä»¶é€šä¿¡å±‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. ç­›é€‰æ¡ä»¶æ¥å£è®¾è®¡
```javascript
/**
 * ç­›é€‰æ¡ä»¶åŸºç±»æ¥å£
 * æ‰€æœ‰ç­›é€‰æ¡ä»¶å¿…é¡»å®ç°æ­¤æ¥å£
 */
class IFilterCondition {
  /**
   * æ¡ä»¶å”¯ä¸€æ ‡è¯†
   * @returns {string}
   */
  getConditionId() {
    throw new Error('Must implement getConditionId()');
  }

  /**
   * æ¡ä»¶ç±»å‹
   * @returns {string} 'field' | 'fuzzy' | 'composite'
   */
  getConditionType() {
    throw new Error('Must implement getConditionType()');
  }

  /**
   * è·å–å¯è¯»æè¿°
   * @returns {string}
   */
  getDescription() {
    throw new Error('Must implement getDescription()');
  }

  /**
   * æ‰§è¡Œç­›é€‰ï¼ˆè¿”å›æ˜¯å¦åŒ¹é…ï¼‰
   * @param {Object} record - PDFè®°å½•
   * @returns {boolean}
   */
  match(record) {
    throw new Error('Must implement match()');
  }

  /**
   * éªŒè¯æ¡ä»¶åˆæ³•æ€§
   * @returns {Object} {valid: boolean, errors: string[]}
   */
  validate() {
    throw new Error('Must implement validate()');
  }

  /**
   * åºåˆ—åŒ–æ¡ä»¶ï¼ˆç”¨äºä¿å­˜å’Œä¼ è¾“ï¼‰
   * @returns {Object}
   */
  serialize() {
    throw new Error('Must implement serialize()');
  }

  /**
   * ååºåˆ—åŒ–æ¡ä»¶
   * @param {Object} config
   */
  deserialize(config) {
    throw new Error('Must implement deserialize()');
  }

  /**
   * å…‹éš†æ¡ä»¶
   * @returns {IFilterCondition}
   */
  clone() {
    throw new Error('Must implement clone()');
  }
}
```

#### 3. å­—æ®µç­›é€‰æ¡ä»¶å®ç°
```javascript
/**
 * å­—æ®µç­›é€‰æ¡ä»¶
 * æ”¯æŒæŒ‰å•ä¸€å­—æ®µè¿›è¡Œç²¾ç¡®ç­›é€‰
 */
class FieldCondition extends IFilterCondition {
  constructor(config = {}) {
    super();
    this.field = config.field || null;          // å­—æ®µå
    this.operator = config.operator || 'eq';    // æ“ä½œç¬¦
    this.value = config.value;                  // ç­›é€‰å€¼
    this.dataType = config.dataType || 'auto';  // æ•°æ®ç±»å‹
  }

  getConditionId() {
    return `field_${this.field}_${Date.now()}`;
  }

  getConditionType() {
    return 'field';
  }

  getDescription() {
    const operatorLabels = {
      'eq': 'ç­‰äº',
      'ne': 'ä¸ç­‰äº',
      'gt': 'å¤§äº',
      'lt': 'å°äº',
      'gte': 'å¤§äºç­‰äº',
      'lte': 'å°äºç­‰äº',
      'contains': 'åŒ…å«',
      'not_contains': 'ä¸åŒ…å«',
      'starts_with': 'å¼€å¤´æ˜¯',
      'ends_with': 'ç»“å°¾æ˜¯',
      'in_range': 'èŒƒå›´å†…',
      'has_tag': 'æ ‡ç­¾åŒ…å«',
      'not_has_tag': 'æ ‡ç­¾ä¸åŒ…å«'
    };

    const opLabel = operatorLabels[this.operator] || this.operator;
    return `${this.field} ${opLabel} ${this.value}`;
  }

  match(record) {
    const fieldValue = record[this.field];

    // å¤„ç† null/undefined
    if (fieldValue == null) {
      return this.operator === 'ne' || this.operator === 'not_contains';
    }

    switch (this.operator) {
      case 'eq':
        return fieldValue == this.value;

      case 'ne':
        return fieldValue != this.value;

      case 'gt':
        return Number(fieldValue) > Number(this.value);

      case 'lt':
        return Number(fieldValue) < Number(this.value);

      case 'gte':
        return Number(fieldValue) >= Number(this.value);

      case 'lte':
        return Number(fieldValue) <= Number(this.value);

      case 'contains':
        return String(fieldValue).toLowerCase().includes(String(this.value).toLowerCase());

      case 'not_contains':
        return !String(fieldValue).toLowerCase().includes(String(this.value).toLowerCase());

      case 'starts_with':
        return String(fieldValue).toLowerCase().startsWith(String(this.value).toLowerCase());

      case 'ends_with':
        return String(fieldValue).toLowerCase().endsWith(String(this.value).toLowerCase());

      case 'in_range':
        const [min, max] = this.value;
        const numValue = Number(fieldValue);
        return numValue >= Number(min) && numValue <= Number(max);

      case 'has_tag':
        // fieldValue åº”è¯¥æ˜¯æ•°ç»„
        if (!Array.isArray(fieldValue)) return false;
        return fieldValue.some(tag => tag.toLowerCase().includes(String(this.value).toLowerCase()));

      case 'not_has_tag':
        if (!Array.isArray(fieldValue)) return true;
        return !fieldValue.some(tag => tag.toLowerCase().includes(String(this.value).toLowerCase()));

      default:
        return false;
    }
  }

  validate() {
    const errors = [];

    if (!this.field) {
      errors.push('å­—æ®µåä¸èƒ½ä¸ºç©º');
    }

    if (!this.operator) {
      errors.push('æ“ä½œç¬¦ä¸èƒ½ä¸ºç©º');
    }

    if (this.value === undefined || this.value === null || this.value === '') {
      if (this.operator !== 'ne' && this.operator !== 'not_contains') {
        errors.push('ç­›é€‰å€¼ä¸èƒ½ä¸ºç©º');
      }
    }

    // èŒƒå›´æ“ä½œç¬¦éœ€è¦æ•°ç»„
    if (this.operator === 'in_range' && !Array.isArray(this.value)) {
      errors.push('èŒƒå›´ç­›é€‰éœ€è¦æä¾›[æœ€å°å€¼, æœ€å¤§å€¼]');
    }

    return {
      valid: errors.length === 0,
      errors
    };
  }

  serialize() {
    return {
      type: 'field',
      field: this.field,
      operator: this.operator,
      value: this.value,
      dataType: this.dataType
    };
  }

  deserialize(config) {
    this.field = config.field;
    this.operator = config.operator;
    this.value = config.value;
    this.dataType = config.dataType || 'auto';
  }

  clone() {
    return new FieldCondition({
      field: this.field,
      operator: this.operator,
      value: this.value,
      dataType: this.dataType
    });
  }
}
```

#### 4. æ¨¡ç³Šæœç´¢æ¡ä»¶å®ç°
```javascript
/**
 * æ¨¡ç³Šæœç´¢æ¡ä»¶
 * åœ¨æ‰€æœ‰å¯æœç´¢å­—æ®µä¸­æŸ¥æ‰¾å…³é”®è¯
 */
class FuzzySearchCondition extends IFilterCondition {
  constructor(config = {}) {
    super();
    this.keywords = config.keywords || [];  // å…³é”®è¯æ•°ç»„
    this.searchFields = config.searchFields || [
      'filename', 'tags', 'created_at', 'updated_at'
    ];  // å¯æœç´¢å­—æ®µ
    this.matchMode = config.matchMode || 'any';  // 'any' æˆ– 'all'
  }

  getConditionId() {
    return `fuzzy_${Date.now()}`;
  }

  getConditionType() {
    return 'fuzzy';
  }

  getDescription() {
    const keywordsStr = this.keywords.join(' ');
    const modeLabel = this.matchMode === 'all' ? 'å…¨éƒ¨åŒ¹é…' : 'ä»»ä¸€åŒ¹é…';
    return `æ¨¡ç³Šæœç´¢: "${keywordsStr}" (${modeLabel})`;
  }

  match(record) {
    if (this.keywords.length === 0) return true;

    const results = this.keywords.map(keyword => {
      return this.searchFields.some(field => {
        const value = record[field];
        if (value == null) return false;

        // å¤„ç†æ•°ç»„å­—æ®µï¼ˆå¦‚tagsï¼‰
        if (Array.isArray(value)) {
          return value.some(item =>
            String(item).toLowerCase().includes(keyword.toLowerCase())
          );
        }

        // å¤„ç†æ™®é€šå­—æ®µ
        return String(value).toLowerCase().includes(keyword.toLowerCase());
      });
    });

    // æ ¹æ®åŒ¹é…æ¨¡å¼è¿”å›ç»“æœ
    return this.matchMode === 'all'
      ? results.every(r => r)  // æ‰€æœ‰å…³é”®è¯éƒ½åŒ¹é…
      : results.some(r => r);  // ä»»ä¸€å…³é”®è¯åŒ¹é…
  }

  validate() {
    const errors = [];

    if (this.keywords.length === 0) {
      errors.push('è‡³å°‘éœ€è¦ä¸€ä¸ªå…³é”®è¯');
    }

    if (this.searchFields.length === 0) {
      errors.push('è‡³å°‘éœ€è¦æŒ‡å®šä¸€ä¸ªæœç´¢å­—æ®µ');
    }

    return {
      valid: errors.length === 0,
      errors
    };
  }

  serialize() {
    return {
      type: 'fuzzy',
      keywords: [...this.keywords],
      searchFields: [...this.searchFields],
      matchMode: this.matchMode
    };
  }

  deserialize(config) {
    this.keywords = config.keywords || [];
    this.searchFields = config.searchFields || [];
    this.matchMode = config.matchMode || 'any';
  }

  clone() {
    return new FuzzySearchCondition({
      keywords: [...this.keywords],
      searchFields: [...this.searchFields],
      matchMode: this.matchMode
    });
  }

  /**
   * ä»æœç´¢æ–‡æœ¬è§£æå…³é”®è¯
   * @param {string} searchText
   */
  static parseKeywords(searchText) {
    // æŒ‰ç©ºæ ¼åˆ†éš”ï¼Œå»é™¤ç©ºç™½
    return searchText
      .split(/\s+/)
      .map(kw => kw.trim())
      .filter(kw => kw.length > 0);
  }
}
```

#### 5. ç»„åˆæ¡ä»¶å®ç°
```javascript
/**
 * ç»„åˆæ¡ä»¶
 * æ”¯æŒ ANDã€ORã€NOT é€»è¾‘ç»„åˆ
 */
class CompositeCondition extends IFilterCondition {
  constructor(config = {}) {
    super();
    this.operator = config.operator || 'AND';  // 'AND', 'OR', 'NOT'
    this.conditions = config.conditions || [];  // å­æ¡ä»¶æ•°ç»„
  }

  getConditionId() {
    return `composite_${this.operator}_${Date.now()}`;
  }

  getConditionType() {
    return 'composite';
  }

  getDescription() {
    if (this.operator === 'NOT') {
      const subDesc = this.conditions[0]?.getDescription() || '';
      return `é (${subDesc})`;
    }

    const subDescriptions = this.conditions.map(c => c.getDescription());
    const opLabel = this.operator === 'AND' ? 'ä¸”' : 'æˆ–';
    return `(${subDescriptions.join(` ${opLabel} `)})`;
  }

  match(record) {
    if (this.conditions.length === 0) return true;

    switch (this.operator) {
      case 'AND':
        return this.conditions.every(condition => condition.match(record));

      case 'OR':
        return this.conditions.some(condition => condition.match(record));

      case 'NOT':
        // NOT åªå¯¹ç¬¬ä¸€ä¸ªæ¡ä»¶å–å
        return !this.conditions[0].match(record);

      default:
        return false;
    }
  }

  validate() {
    const errors = [];

    if (this.conditions.length === 0) {
      errors.push('ç»„åˆæ¡ä»¶è‡³å°‘éœ€è¦ä¸€ä¸ªå­æ¡ä»¶');
    }

    if (this.operator === 'NOT' && this.conditions.length > 1) {
      errors.push('NOT æ“ä½œç¬¦åªèƒ½æœ‰ä¸€ä¸ªå­æ¡ä»¶');
    }

    // éªŒè¯æ‰€æœ‰å­æ¡ä»¶
    this.conditions.forEach((condition, index) => {
      const validation = condition.validate();
      if (!validation.valid) {
        errors.push(`å­æ¡ä»¶${index + 1}éªŒè¯å¤±è´¥: ${validation.errors.join(', ')}`);
      }
    });

    return {
      valid: errors.length === 0,
      errors
    };
  }

  serialize() {
    return {
      type: 'composite',
      operator: this.operator,
      conditions: this.conditions.map(c => c.serialize())
    };
  }

  deserialize(config) {
    this.operator = config.operator;
    this.conditions = config.conditions.map(condConfig => {
      return FilterConditionFactory.createFromConfig(condConfig);
    });
  }

  clone() {
    return new CompositeCondition({
      operator: this.operator,
      conditions: this.conditions.map(c => c.clone())
    });
  }

  /**
   * æ·»åŠ å­æ¡ä»¶
   */
  addCondition(condition) {
    this.conditions.push(condition);
  }

  /**
   * ç§»é™¤å­æ¡ä»¶
   */
  removeCondition(index) {
    this.conditions.splice(index, 1);
  }
}
```

#### 6. æ¡ä»¶å·¥å‚
```javascript
/**
 * ç­›é€‰æ¡ä»¶å·¥å‚
 * ç”¨äºåˆ›å»ºå’Œååºåˆ—åŒ–æ¡ä»¶
 */
class FilterConditionFactory {
  /**
   * ä»é…ç½®åˆ›å»ºæ¡ä»¶
   */
  static createFromConfig(config) {
    switch (config.type) {
      case 'field':
        const fieldCond = new FieldCondition();
        fieldCond.deserialize(config);
        return fieldCond;

      case 'fuzzy':
        const fuzzyCond = new FuzzySearchCondition();
        fuzzyCond.deserialize(config);
        return fuzzyCond;

      case 'composite':
        const compCond = new CompositeCondition();
        compCond.deserialize(config);
        return compCond;

      default:
        throw new Error(`æœªçŸ¥çš„æ¡ä»¶ç±»å‹: ${config.type}`);
    }
  }

  /**
   * ä»æŸ¥è¯¢å­—ç¬¦ä¸²åˆ›å»ºæ¡ä»¶ï¼ˆè§£æç®€å•è¯­æ³•ï¼‰
   * ä¾‹å¦‚: "filename:Python AND rating:>=4"
   */
  static createFromQueryString(queryString) {
    // v002+ å®ç°æŸ¥è¯¢è¯­è¨€è§£æå™¨
    throw new Error('æŸ¥è¯¢è¯­è¨€è§£æå™¨å°šæœªå®ç°');
  }
}
```

#### 7. ç­›é€‰ç®¡ç†å™¨
```javascript
/**
 * ç­›é€‰ç®¡ç†å™¨
 * è´Ÿè´£ç®¡ç†ç­›é€‰æ¡ä»¶ã€æ‰§è¡Œç­›é€‰ã€ç®¡ç†çŠ¶æ€
 */
class FilterManager {
  constructor(dependencies) {
    this.eventBus = dependencies.eventBus;
    this.logger = dependencies.logger;

    // å½“å‰æ´»è·ƒçš„æ¡ä»¶
    this.activeConditions = [];

    // ç­›é€‰æ¨¡å¼
    this.filterMode = 'simple';  // 'simple' æˆ– 'advanced'

    // ç­›é€‰ç»“æœç¼“å­˜
    this.filteredData = [];
    this.originalData = [];

    // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
    this._setupEventListeners();
  }

  /**
   * è®¾ç½®æ•°æ®æº
   */
  setDataSource(data) {
    this.originalData = data;
    this.applyFilters();
  }

  /**
   * æ·»åŠ ç­›é€‰æ¡ä»¶
   */
  addCondition(condition) {
    const validation = condition.validate();
    if (!validation.valid) {
      throw new Error(`æ¡ä»¶éªŒè¯å¤±è´¥: ${validation.errors.join(', ')}`);
    }

    this.activeConditions.push(condition);
    this.logger.info('[FilterManager] æ·»åŠ ç­›é€‰æ¡ä»¶', condition.getDescription());

    // åº”ç”¨ç­›é€‰
    this.applyFilters();

    // è§¦å‘äº‹ä»¶
    this.eventBus.emit('filter:condition-added', {
      condition: condition.serialize(),
      totalConditions: this.activeConditions.length
    });
  }

  /**
   * ç§»é™¤ç­›é€‰æ¡ä»¶
   */
  removeCondition(conditionId) {
    const index = this.activeConditions.findIndex(
      c => c.getConditionId() === conditionId
    );

    if (index === -1) {
      this.logger.warn('[FilterManager] æ¡ä»¶ä¸å­˜åœ¨', conditionId);
      return;
    }

    const removed = this.activeConditions.splice(index, 1)[0];
    this.logger.info('[FilterManager] ç§»é™¤ç­›é€‰æ¡ä»¶', removed.getDescription());

    // é‡æ–°åº”ç”¨ç­›é€‰
    this.applyFilters();

    // è§¦å‘äº‹ä»¶
    this.eventBus.emit('filter:condition-removed', {
      conditionId,
      totalConditions: this.activeConditions.length
    });
  }

  /**
   * æ¸…é™¤æ‰€æœ‰æ¡ä»¶
   */
  clearAllConditions() {
    this.logger.info('[FilterManager] æ¸…é™¤æ‰€æœ‰ç­›é€‰æ¡ä»¶');
    this.activeConditions = [];

    // é‡ç½®ç­›é€‰
    this.applyFilters();

    // è§¦å‘äº‹ä»¶
    this.eventBus.emit('filter:all-cleared');
  }

  /**
   * åº”ç”¨ç­›é€‰
   */
  applyFilters() {
    this.logger.info('[FilterManager] åº”ç”¨ç­›é€‰', {
      conditions: this.activeConditions.length,
      records: this.originalData.length
    });

    // å¦‚æœæ²¡æœ‰æ¡ä»¶ï¼Œè¿”å›å…¨éƒ¨æ•°æ®
    if (this.activeConditions.length === 0) {
      this.filteredData = [...this.originalData];
    } else {
      // æ‰§è¡Œç­›é€‰
      this.filteredData = this.originalData.filter(record => {
        return this.activeConditions.every(condition => {
          return condition.match(record);
        });
      });
    }

    this.logger.info('[FilterManager] ç­›é€‰å®Œæˆ', {
      original: this.originalData.length,
      filtered: this.filteredData.length
    });

    // è§¦å‘äº‹ä»¶
    this.eventBus.emit('filter:applied', {
      totalRecords: this.originalData.length,
      filteredRecords: this.filteredData.length,
      conditions: this.activeConditions.map(c => c.serialize())
    });

    return this.filteredData;
  }

  /**
   * è·å–ç­›é€‰ç»“æœ
   */
  getFilteredData() {
    return this.filteredData;
  }

  /**
   * è·å–å½“å‰æ¡ä»¶æè¿°
   */
  getActiveConditionsDescription() {
    return this.activeConditions.map(c => c.getDescription());
  }

  /**
   * åˆ‡æ¢ç­›é€‰æ¨¡å¼
   */
  setFilterMode(mode) {
    if (!['simple', 'advanced'].includes(mode)) {
      throw new Error(`æ— æ•ˆçš„ç­›é€‰æ¨¡å¼: ${mode}`);
    }

    this.filterMode = mode;
    this.eventBus.emit('filter:mode-changed', { mode });
  }

  /**
   * å¯¼å‡ºç­›é€‰é…ç½®
   */
  exportFilterConfig() {
    return {
      mode: this.filterMode,
      conditions: this.activeConditions.map(c => c.serialize()),
      timestamp: Date.now()
    };
  }

  /**
   * å¯¼å…¥ç­›é€‰é…ç½®
   */
  importFilterConfig(config) {
    this.filterMode = config.mode || 'simple';
    this.activeConditions = (config.conditions || []).map(condConfig => {
      return FilterConditionFactory.createFromConfig(condConfig);
    });

    this.applyFilters();
  }

  /**
   * è®¾ç½®äº‹ä»¶ç›‘å¬
   * @private
   */
  _setupEventListeners() {
    // ç›‘å¬æ•°æ®æ›´æ–°
    this.eventBus.on('pdf:list:updated', (data) => {
      this.setDataSource(data.items || []);
    });
  }
}
```

#### 8. ç­›é€‰æœç´¢æ¡† UI ç»„ä»¶
```javascript
/**
 * ç­›é€‰æœç´¢æ¡†ç»„ä»¶ï¼ˆç®€å•æ¨¡å¼ï¼‰
 */
class FilterSearchBar {
  constructor(dependencies) {
    this.eventBus = dependencies.eventBus;
    this.logger = dependencies.logger;
    this.filterManager = dependencies.filterManager;

    this.container = null;
    this.searchInput = null;
    this.searchTimeout = null;

    this._createUI();
    this._setupEventListeners();
  }

  /**
   * åˆ›å»º UI
   */
  _createUI() {
    const html = `
      <div id="filter-search-bar" class="filter-search-bar">
        <div class="search-input-group">
          <!-- æœç´¢å›¾æ ‡ -->
          <span class="search-icon">ğŸ”</span>

          <!-- æœç´¢è¾“å…¥æ¡† -->
          <input
            type="text"
            class="search-input"
            placeholder="æœç´¢ PDF (æ”¯æŒå¤šå…³é”®è¯ï¼Œç©ºæ ¼åˆ†éš”)..."
            autocomplete="off"
          >

          <!-- æ¸…é™¤æŒ‰é’® -->
          <button class="btn-clear" hidden aria-label="æ¸…é™¤">
            &times;
          </button>

          <!-- é«˜çº§ç­›é€‰æŒ‰é’® -->
          <button class="btn-advanced" title="é«˜çº§ç­›é€‰">
            <span>âš™ï¸ é«˜çº§</span>
          </button>
        </div>

        <!-- æ´»è·ƒæ¡ä»¶æ˜¾ç¤º -->
        <div class="active-conditions" id="active-conditions" hidden>
          <div class="conditions-label">ç­›é€‰æ¡ä»¶:</div>
          <div class="conditions-list" id="conditions-list"></div>
          <button class="btn-clear-all">æ¸…é™¤å…¨éƒ¨</button>
        </div>

        <!-- ç­›é€‰ç»“æœç»Ÿè®¡ -->
        <div class="filter-stats" id="filter-stats" hidden>
          <span class="stats-text">
            æ˜¾ç¤º <strong id="filtered-count">0</strong> / <strong id="total-count">0</strong> é¡¹
          </span>
        </div>
      </div>
    `;

    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = html.trim();
    this.container = tempDiv.firstChild;

    // æ’å…¥åˆ°é¡µé¢é¡¶éƒ¨ï¼ˆè¡¨æ ¼ä¹‹å‰ï¼‰
    const tableContainer = document.querySelector('.table-container');
    if (tableContainer) {
      tableContainer.parentNode.insertBefore(this.container, tableContainer);
    } else {
      document.body.appendChild(this.container);
    }

    this.searchInput = this.container.querySelector('.search-input');
  }

  /**
   * è®¾ç½®äº‹ä»¶ç›‘å¬
   */
  _setupEventListeners() {
    const clearBtn = this.container.querySelector('.btn-clear');
    const advancedBtn = this.container.querySelector('.btn-advanced');
    const clearAllBtn = this.container.querySelector('.btn-clear-all');

    // æœç´¢è¾“å…¥ï¼ˆé˜²æŠ–ï¼‰
    this.searchInput.addEventListener('input', (e) => {
      const searchText = e.target.value.trim();

      // æ˜¾ç¤º/éšè—æ¸…é™¤æŒ‰é’®
      clearBtn.hidden = searchText.length === 0;

      // é˜²æŠ–å¤„ç†
      clearTimeout(this.searchTimeout);
      this.searchTimeout = setTimeout(() => {
        this._performSearch(searchText);
      }, 300);
    });

    // å›è½¦ç«‹å³æœç´¢
    this.searchInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        clearTimeout(this.searchTimeout);
        this._performSearch(this.searchInput.value.trim());
      }
    });

    // æ¸…é™¤æŒ‰é’®
    clearBtn.addEventListener('click', () => {
      this.searchInput.value = '';
      clearBtn.hidden = true;
      this._performSearch('');
    });

    // é«˜çº§ç­›é€‰æŒ‰é’®
    advancedBtn.addEventListener('click', () => {
      this.eventBus.emit('filter:show-advanced-builder');
    });

    // æ¸…é™¤å…¨éƒ¨æŒ‰é’®
    clearAllBtn.addEventListener('click', () => {
      this.filterManager.clearAllConditions();
      this.searchInput.value = '';
      clearBtn.hidden = true;
    });

    // ç›‘å¬ç­›é€‰æ¡ä»¶å˜åŒ–
    this.eventBus.on('filter:condition-added', () => {
      this._updateActiveConditionsDisplay();
    });

    this.eventBus.on('filter:condition-removed', () => {
      this._updateActiveConditionsDisplay();
    });

    this.eventBus.on('filter:all-cleared', () => {
      this._updateActiveConditionsDisplay();
    });

    // ç›‘å¬ç­›é€‰ç»“æœ
    this.eventBus.on('filter:applied', (data) => {
      this._updateStatsDisplay(data.filteredRecords, data.totalRecords);
    });
  }

  /**
   * æ‰§è¡Œæœç´¢
   */
  _performSearch(searchText) {
    this.logger.info('[FilterSearchBar] æ‰§è¡Œæœç´¢', { searchText });

    // æ¸…é™¤ä¹‹å‰çš„æ¨¡ç³Šæœç´¢æ¡ä»¶
    const existingFuzzy = this.filterManager.activeConditions.find(
      c => c.getConditionType() === 'fuzzy'
    );
    if (existingFuzzy) {
      this.filterManager.removeCondition(existingFuzzy.getConditionId());
    }

    // å¦‚æœæœç´¢æ–‡æœ¬ä¸ºç©ºï¼Œç›´æ¥è¿”å›
    if (!searchText) {
      return;
    }

    // åˆ›å»ºæ¨¡ç³Šæœç´¢æ¡ä»¶
    const keywords = FuzzySearchCondition.parseKeywords(searchText);
    const fuzzyCondition = new FuzzySearchCondition({
      keywords,
      searchFields: ['filename', 'tags'],
      matchMode: 'any'
    });

    // æ·»åŠ æ¡ä»¶
    this.filterManager.addCondition(fuzzyCondition);
  }

  /**
   * æ›´æ–°æ´»è·ƒæ¡ä»¶æ˜¾ç¤º
   */
  _updateActiveConditionsDisplay() {
    const conditionsDiv = this.container.querySelector('#active-conditions');
    const conditionsList = this.container.querySelector('#conditions-list');

    const conditions = this.filterManager.activeConditions;

    if (conditions.length === 0) {
      conditionsDiv.hidden = true;
      return;
    }

    conditionsDiv.hidden = false;

    // æ¸²æŸ“æ¡ä»¶
    const conditionsHtml = conditions.map(condition => {
      const id = condition.getConditionId();
      const desc = condition.getDescription();
      return `
        <div class="condition-chip" data-id="${id}">
          <span class="condition-text">${desc}</span>
          <button class="btn-remove" data-id="${id}" aria-label="ç§»é™¤">&times;</button>
        </div>
      `;
    }).join('');

    conditionsList.innerHTML = conditionsHtml;

    // æ·»åŠ ç§»é™¤æŒ‰é’®äº‹ä»¶
    conditionsList.querySelectorAll('.btn-remove').forEach(btn => {
      btn.addEventListener('click', () => {
        this.filterManager.removeCondition(btn.dataset.id);
      });
    });
  }

  /**
   * æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
   */
  _updateStatsDisplay(filteredCount, totalCount) {
    const statsDiv = this.container.querySelector('#filter-stats');
    const filteredSpan = this.container.querySelector('#filtered-count');
    const totalSpan = this.container.querySelector('#total-count');

    statsDiv.hidden = false;
    filteredSpan.textContent = filteredCount;
    totalSpan.textContent = totalCount;

    // å¦‚æœå…¨éƒ¨æ˜¾ç¤ºï¼Œéšè—ç»Ÿè®¡
    if (filteredCount === totalCount && this.filterManager.activeConditions.length === 0) {
      statsDiv.hidden = true;
    }
  }
}
```

#### 9. é«˜çº§ç­›é€‰æ„å»ºå™¨ UI ç»„ä»¶
```javascript
/**
 * é«˜çº§ç­›é€‰æ„å»ºå™¨ï¼ˆé«˜çº§æ¨¡å¼ï¼‰
 */
class FilterBuilder {
  constructor(dependencies) {
    this.eventBus = dependencies.eventBus;
    this.logger = dependencies.logger;
    this.filterManager = dependencies.filterManager;

    this.container = null;
    this.conditionsList = [];

    this._createUI();
    this._setupEventListeners();
  }

  /**
   * åˆ›å»º UI
   */
  _createUI() {
    const html = `
      <div id="filter-builder" class="filter-builder" hidden>
        <div class="filter-builder-overlay"></div>
        <div class="filter-builder-dialog">
          <!-- å¤´éƒ¨ -->
          <div class="filter-builder-header">
            <h3>é«˜çº§ç­›é€‰</h3>
            <button class="btn-close" aria-label="å…³é—­">&times;</button>
          </div>

          <!-- ä¸»ä½“ -->
          <div class="filter-builder-body">
            <!-- æ¡ä»¶åˆ—è¡¨ -->
            <div class="conditions-builder" id="conditions-builder">
              <div class="empty-state">
                <p>æš‚æ— ç­›é€‰æ¡ä»¶</p>
                <button class="btn-add-first">æ·»åŠ ç¬¬ä¸€ä¸ªæ¡ä»¶</button>
              </div>
            </div>

            <!-- æ·»åŠ æ¡ä»¶æŒ‰é’® -->
            <div class="add-condition-row">
              <button class="btn-add-condition">+ æ·»åŠ æ¡ä»¶</button>
              <button class="btn-add-group">+ æ·»åŠ æ¡ä»¶ç»„</button>
            </div>
          </div>

          <!-- åº•éƒ¨æ“ä½œ -->
          <div class="filter-builder-footer">
            <div class="preview">
              <strong>é¢„è§ˆ:</strong>
              <span id="conditions-preview">æ— æ¡ä»¶</span>
            </div>
            <div class="actions">
              <button class="btn-reset">é‡ç½®</button>
              <button class="btn-apply">åº”ç”¨ç­›é€‰</button>
            </div>
          </div>
        </div>
      </div>
    `;

    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = html.trim();
    this.container = tempDiv.firstChild;
    document.body.appendChild(this.container);
  }

  /**
   * æ˜¾ç¤ºæ„å»ºå™¨
   */
  show() {
    this.container.hidden = false;
    this._loadCurrentConditions();
  }

  /**
   * éšè—æ„å»ºå™¨
   */
  hide() {
    this.container.hidden = true;
  }

  /**
   * æ·»åŠ æ¡ä»¶è¡Œ
   */
  addConditionRow(config = {}) {
    const rowId = `cond_${Date.now()}`;
    const row = {
      id: rowId,
      field: config.field || 'filename',
      operator: config.operator || 'contains',
      value: config.value || '',
      logic: config.logic || 'AND'  // ä¸ä¸‹ä¸€ä¸ªæ¡ä»¶çš„é€»è¾‘å…³ç³»
    };

    this.conditionsList.push(row);
    this._renderConditions();
    this._updatePreview();
  }

  /**
   * ç§»é™¤æ¡ä»¶è¡Œ
   */
  removeConditionRow(rowId) {
    const index = this.conditionsList.findIndex(r => r.id === rowId);
    if (index > -1) {
      this.conditionsList.splice(index, 1);
      this._renderConditions();
      this._updatePreview();
    }
  }

  /**
   * æ¸²æŸ“æ¡ä»¶åˆ—è¡¨
   */
  _renderConditions() {
    const builderDiv = this.container.querySelector('#conditions-builder');

    if (this.conditionsList.length === 0) {
      builderDiv.innerHTML = `
        <div class="empty-state">
          <p>æš‚æ— ç­›é€‰æ¡ä»¶</p>
          <button class="btn-add-first">æ·»åŠ ç¬¬ä¸€ä¸ªæ¡ä»¶</button>
        </div>
      `;

      // ç»‘å®šäº‹ä»¶
      builderDiv.querySelector('.btn-add-first').addEventListener('click', () => {
        this.addConditionRow();
      });

      return;
    }

    // æ¸²æŸ“æ¯ä¸ªæ¡ä»¶è¡Œ
    const rowsHtml = this.conditionsList.map((row, index) => {
      const isLast = index === this.conditionsList.length - 1;

      return `
        <div class="condition-row" data-id="${row.id}">
          <!-- é€»è¾‘æ“ä½œç¬¦ï¼ˆä¸æ˜¾ç¤ºåœ¨ç¬¬ä¸€è¡Œï¼‰ -->
          ${index > 0 ? `
            <div class="logic-selector">
              <select class="logic-select" data-id="${row.id}">
                <option value="AND" ${row.logic === 'AND' ? 'selected' : ''}>ä¸” (AND)</option>
                <option value="OR" ${row.logic === 'OR' ? 'selected' : ''}>æˆ– (OR)</option>
              </select>
            </div>
          ` : ''}

          <!-- æ¡ä»¶ç¼–è¾‘å™¨ -->
          <div class="condition-editor">
            <!-- å­—æ®µé€‰æ‹© -->
            <select class="field-select" data-id="${row.id}">
              <option value="filename" ${row.field === 'filename' ? 'selected' : ''}>æ–‡ä»¶å</option>
              <option value="tags" ${row.field === 'tags' ? 'selected' : ''}>æ ‡ç­¾</option>
              <option value="rating" ${row.field === 'rating' ? 'selected' : ''}>è¯„åˆ†</option>
              <option value="review_count" ${row.field === 'review_count' ? 'selected' : ''}>å¤ä¹ æ¬¡æ•°</option>
              <option value="file_size" ${row.field === 'file_size' ? 'selected' : ''}>æ–‡ä»¶å¤§å°</option>
              <option value="created_at" ${row.field === 'created_at' ? 'selected' : ''}>åˆ›å»ºæ—¶é—´</option>
              <option value="last_accessed_at" ${row.field === 'last_accessed_at' ? 'selected' : ''}>è®¿é—®æ—¶é—´</option>
            </select>

            <!-- æ“ä½œç¬¦é€‰æ‹© -->
            <select class="operator-select" data-id="${row.id}">
              ${this._getOperatorOptions(row.field, row.operator)}
            </select>

            <!-- å€¼è¾“å…¥ -->
            <input
              type="text"
              class="value-input"
              data-id="${row.id}"
              value="${row.value}"
              placeholder="è¾“å…¥ç­›é€‰å€¼..."
            >

            <!-- åˆ é™¤æŒ‰é’® -->
            <button class="btn-remove-row" data-id="${row.id}" aria-label="åˆ é™¤">
              ğŸ—‘ï¸
            </button>
          </div>
        </div>
      `;
    }).join('');

    builderDiv.innerHTML = rowsHtml;

    // ç»‘å®šäº‹ä»¶
    this._bindConditionRowEvents();
  }

  /**
   * è·å–æ“ä½œç¬¦é€‰é¡¹ï¼ˆæ ¹æ®å­—æ®µç±»å‹ï¼‰
   */
  _getOperatorOptions(field, currentOperator) {
    let operators = [];

    // æ ¹æ®å­—æ®µç±»å‹è¿”å›ä¸åŒçš„æ“ä½œç¬¦
    const stringFields = ['filename', 'tags'];
    const numberFields = ['rating', 'review_count', 'file_size'];
    const dateFields = ['created_at', 'updated_at', 'last_accessed_at'];

    if (stringFields.includes(field)) {
      operators = [
        { value: 'contains', label: 'åŒ…å«' },
        { value: 'not_contains', label: 'ä¸åŒ…å«' },
        { value: 'eq', label: 'ç­‰äº' },
        { value: 'starts_with', label: 'å¼€å¤´æ˜¯' },
        { value: 'ends_with', label: 'ç»“å°¾æ˜¯' }
      ];
    } else if (numberFields.includes(field)) {
      operators = [
        { value: 'eq', label: 'ç­‰äº' },
        { value: 'ne', label: 'ä¸ç­‰äº' },
        { value: 'gt', label: 'å¤§äº' },
        { value: 'lt', label: 'å°äº' },
        { value: 'gte', label: 'å¤§äºç­‰äº' },
        { value: 'lte', label: 'å°äºç­‰äº' }
      ];
    } else if (dateFields.includes(field)) {
      operators = [
        { value: 'eq', label: 'ç­‰äº' },
        { value: 'gt', label: 'ä¹‹å' },
        { value: 'lt', label: 'ä¹‹å‰' },
        { value: 'in_range', label: 'èŒƒå›´å†…' }
      ];
    }

    return operators.map(op => {
      const selected = op.value === currentOperator ? 'selected' : '';
      return `<option value="${op.value}" ${selected}>${op.label}</option>`;
    }).join('');
  }

  /**
   * ç»‘å®šæ¡ä»¶è¡Œäº‹ä»¶
   */
  _bindConditionRowEvents() {
    const builderDiv = this.container.querySelector('#conditions-builder');

    // é€»è¾‘é€‰æ‹©å™¨å˜åŒ–
    builderDiv.querySelectorAll('.logic-select').forEach(select => {
      select.addEventListener('change', (e) => {
        const rowId = e.target.dataset.id;
        const row = this.conditionsList.find(r => r.id === rowId);
        if (row) {
          row.logic = e.target.value;
          this._updatePreview();
        }
      });
    });

    // å­—æ®µé€‰æ‹©å™¨å˜åŒ–
    builderDiv.querySelectorAll('.field-select').forEach(select => {
      select.addEventListener('change', (e) => {
        const rowId = e.target.dataset.id;
        const row = this.conditionsList.find(r => r.id === rowId);
        if (row) {
          row.field = e.target.value;
          // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°æ“ä½œç¬¦é€‰é¡¹
          this._renderConditions();
          this._updatePreview();
        }
      });
    });

    // æ“ä½œç¬¦é€‰æ‹©å™¨å˜åŒ–
    builderDiv.querySelectorAll('.operator-select').forEach(select => {
      select.addEventListener('change', (e) => {
        const rowId = e.target.dataset.id;
        const row = this.conditionsList.find(r => r.id === rowId);
        if (row) {
          row.operator = e.target.value;
          this._updatePreview();
        }
      });
    });

    // å€¼è¾“å…¥å˜åŒ–
    builderDiv.querySelectorAll('.value-input').forEach(input => {
      input.addEventListener('input', (e) => {
        const rowId = e.target.dataset.id;
        const row = this.conditionsList.find(r => r.id === rowId);
        if (row) {
          row.value = e.target.value;
          this._updatePreview();
        }
      });
    });

    // åˆ é™¤æŒ‰é’®
    builderDiv.querySelectorAll('.btn-remove-row').forEach(btn => {
      btn.addEventListener('click', () => {
        this.removeConditionRow(btn.dataset.id);
      });
    });
  }

  /**
   * æ›´æ–°é¢„è§ˆ
   */
  _updatePreview() {
    const previewSpan = this.container.querySelector('#conditions-preview');

    if (this.conditionsList.length === 0) {
      previewSpan.textContent = 'æ— æ¡ä»¶';
      return;
    }

    // æ„å»ºæè¿°æ–‡æœ¬
    const descriptions = this.conditionsList.map((row, index) => {
      let desc = `${row.field} ${row.operator} "${row.value}"`;
      if (index > 0) {
        desc = `${row.logic} ${desc}`;
      }
      return desc;
    });

    previewSpan.textContent = descriptions.join(' ');
  }

  /**
   * åº”ç”¨ç­›é€‰
   */
  applyFilter() {
    // æ¸…é™¤ç°æœ‰æ¡ä»¶
    this.filterManager.clearAllConditions();

    // æ„å»ºæ¡ä»¶
    if (this.conditionsList.length === 0) {
      this.hide();
      return;
    }

    // å°†æ¡ä»¶åˆ—è¡¨è½¬æ¢ä¸ºæ¡ä»¶å¯¹è±¡
    let rootCondition = null;

    if (this.conditionsList.length === 1) {
      // å•ä¸ªæ¡ä»¶
      const row = this.conditionsList[0];
      rootCondition = new FieldCondition({
        field: row.field,
        operator: row.operator,
        value: row.value
      });
    } else {
      // å¤šä¸ªæ¡ä»¶ï¼Œéœ€è¦ç»„åˆ
      rootCondition = this._buildCompositeCondition();
    }

    // æ·»åŠ åˆ°ç®¡ç†å™¨
    this.filterManager.addCondition(rootCondition);

    this.hide();
  }

  /**
   * æ„å»ºç»„åˆæ¡ä»¶
   */
  _buildCompositeCondition() {
    // ç®€å•å®ç°ï¼šæŒ‰é¡ºåºç»„åˆ
    // v002+ å¯ä»¥æ”¯æŒæ›´å¤æ‚çš„åˆ†ç»„å’Œä¼˜å…ˆçº§

    let currentComposite = null;
    let currentOperator = 'AND';

    this.conditionsList.forEach((row, index) => {
      const fieldCond = new FieldCondition({
        field: row.field,
        operator: row.operator,
        value: row.value
      });

      if (index === 0) {
        currentComposite = fieldCond;
      } else {
        const newComposite = new CompositeCondition({
          operator: row.logic,
          conditions: [currentComposite, fieldCond]
        });
        currentComposite = newComposite;
      }
    });

    return currentComposite;
  }

  /**
   * åŠ è½½å½“å‰æ¡ä»¶
   */
  _loadCurrentConditions() {
    // ä» FilterManager åŠ è½½ç°æœ‰æ¡ä»¶
    // v001 ç®€åŒ–å®ç°ï¼šæ¸…ç©ºé‡æ–°å¼€å§‹
    this.conditionsList = [];
    this._renderConditions();
  }

  /**
   * è®¾ç½®äº‹ä»¶ç›‘å¬
   */
  _setupEventListeners() {
    const closeBtn = this.container.querySelector('.btn-close');
    const resetBtn = this.container.querySelector('.btn-reset');
    const applyBtn = this.container.querySelector('.btn-apply');
    const addConditionBtn = this.container.querySelector('.btn-add-condition');
    const overlay = this.container.querySelector('.filter-builder-overlay');

    // å…³é—­
    closeBtn.addEventListener('click', () => this.hide());
    overlay.addEventListener('click', () => this.hide());

    // é‡ç½®
    resetBtn.addEventListener('click', () => {
      this.conditionsList = [];
      this._renderConditions();
      this._updatePreview();
    });

    // åº”ç”¨
    applyBtn.addEventListener('click', () => {
      this.applyFilter();
    });

    // æ·»åŠ æ¡ä»¶
    addConditionBtn.addEventListener('click', () => {
      this.addConditionRow();
    });

    // ç›‘å¬æ˜¾ç¤ºäº‹ä»¶
    this.eventBus.on('filter:show-advanced-builder', () => {
      this.show();
    });
  }
}
```

### WebSocket åè®®æ‰©å±•ï¼ˆå¯é€‰ï¼Œv002+ï¼‰

#### åç«¯ç­›é€‰æ”¯æŒ
```json
// å‰ç«¯ â†’ åç«¯ï¼šç­›é€‰è¯·æ±‚ï¼ˆæœåŠ¡ç«¯åˆ†é¡µåœºæ™¯ï¼‰
{
  "type": "pdf:filter:request",
  "request_id": "req_filter_12345",
  "timestamp": "2025-10-02T00:56:35Z",
  "data": {
    "conditions": [
      {
        "type": "field",
        "field": "rating",
        "operator": "gte",
        "value": 4
      }
    ],
    "page": 1,
    "pageSize": 50
  }
}

// åç«¯ â†’ å‰ç«¯ï¼šç­›é€‰å“åº”
{
  "type": "pdf:filter:response",
  "request_id": "req_filter_12345",
  "timestamp": "2025-10-02T00:56:36Z",
  "data": {
    "items": [...],  // ç­›é€‰åçš„æ•°æ®
    "total": 150,    // æ€»è®°å½•æ•°
    "filtered": 45,  // ç­›é€‰åæ•°é‡
    "page": 1,
    "pageSize": 50
  }
}
```

## çº¦æŸæ¡ä»¶

### ä»…ä¿®æ”¹ pdf-home æ¨¡å—ä»£ç 
ä»…åœ¨ `src/frontend/pdf-home/` ç›®å½•ä¸‹æ·»åŠ æ–°ä»£ç ï¼Œä¸ä¿®æ”¹å…¶ä»–æ¨¡å—ã€‚

å…è®¸çš„æ–°å¢æ–‡ä»¶ï¼š
- `src/frontend/pdf-home/filter/filter-manager.js` - ç­›é€‰ç®¡ç†å™¨
- `src/frontend/pdf-home/filter/filter-conditions.js` - ç­›é€‰æ¡ä»¶å®ç°
- `src/frontend/pdf-home/filter/filter-condition-factory.js` - æ¡ä»¶å·¥å‚
- `src/frontend/pdf-home/ui/filter-search-bar.js` - æœç´¢æ¡†ç»„ä»¶
- `src/frontend/pdf-home/ui/filter-builder.js` - é«˜çº§æ„å»ºå™¨
- `src/frontend/pdf-home/__tests__/filter-manager.test.js` - å•å…ƒæµ‹è¯•
- `src/frontend/pdf-home/__tests__/filter-conditions.test.js` - å•å…ƒæµ‹è¯•

### ä¸¥æ ¼éµå¾ªä»£ç è§„èŒƒå’Œæ ‡å‡†
å¿…é¡»ä¼˜å…ˆé˜…è¯»å’Œç†è§£ï¼š
1. `src/frontend/pdf-home/docs/SPEC/SPEC-HEAD-PDFHome.json`
2. `docs/SPEC/FRONTEND-EVENT-BUS-001.md`
3. `docs/SPEC/JAVASCRIPT-CLASS-STRUCTURE-001.md`
4. `docs/SPEC/JAVASCRIPT-FUNCTION-DESIGN-001.md`

### æ¶æ„è®¾è®¡åŸåˆ™
1. **ç­–ç•¥æ¨¡å¼**: æ‰€æœ‰ç­›é€‰é€»è¾‘é€šè¿‡æ¡ä»¶æ¥å£å®ç°
2. **å¼€é—­åŸåˆ™**: æ–°å¢ç­›é€‰ç±»å‹ä¸ä¿®æ”¹ç°æœ‰ä»£ç 
3. **å•ä¸€èŒè´£**: Manager è´Ÿè´£åè°ƒï¼ŒCondition è´Ÿè´£åŒ¹é…é€»è¾‘ï¼ŒUI è´Ÿè´£å±•ç¤º
4. **ä¾èµ–æ³¨å…¥**: æ‰€æœ‰ç»„ä»¶é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–
5. **äº‹ä»¶é©±åŠ¨**: ç»„ä»¶é—´é€šè¿‡ EventBus è§£è€¦

### æ€§èƒ½è¦æ±‚
- ç­›é€‰å“åº”æ—¶é—´ < 500msï¼ˆ1000æ¡è®°å½•ï¼‰
- è¾“å…¥é˜²æŠ–å»¶è¿Ÿ: 300ms
- æ”¯æŒå¤§æ•°æ®é‡ï¼ˆ10000+æ¡ï¼‰çš„é«˜æ•ˆç­›é€‰
- ä½¿ç”¨ Web Worker å¤„ç†å¤§æ•°æ®é‡ç­›é€‰ï¼ˆv002+ï¼‰

### å‘åå…¼å®¹æ€§
- ä¿æŒ Tabulator åŸæœ‰çš„åˆ—å¤´ç­›é€‰åŠŸèƒ½
- æ–°ç­›é€‰ç³»ç»Ÿä½œä¸ºå¢å¼ºåŠŸèƒ½
- ä¸ç ´åç°æœ‰çš„è¡¨æ ¼äº¤äº’

## å¯è¡ŒéªŒæ”¶æ ‡å‡†

### å•å…ƒæµ‹è¯•

#### 1. FilterCondition æµ‹è¯•è¦†ç›–ç‡ â‰¥ 95%
- FieldCondition å„æ“ä½œç¬¦æµ‹è¯•
- FuzzySearchCondition å…³é”®è¯åŒ¹é…æµ‹è¯•
- CompositeCondition é€»è¾‘ç»„åˆæµ‹è¯•
- è¾¹ç•Œæƒ…å†µæµ‹è¯•ï¼ˆnullã€undefinedã€ç©ºå­—ç¬¦ä¸²ï¼‰

#### 2. FilterManager æµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%
- æ¡ä»¶æ·»åŠ /ç§»é™¤/æ¸…é™¤æµ‹è¯•
- ç­›é€‰æ‰§è¡Œæµ‹è¯•
- æ•°æ®æºæ›´æ–°æµ‹è¯•
- é…ç½®å¯¼å…¥/å¯¼å‡ºæµ‹è¯•

#### 3. UI ç»„ä»¶æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- æœç´¢æ¡†è¾“å…¥æµ‹è¯•
- æ¡ä»¶æ˜¾ç¤ºæµ‹è¯•
- æ„å»ºå™¨äº¤äº’æµ‹è¯•

### ç«¯åˆ°ç«¯æµ‹è¯•

#### æµ‹è¯•åœºæ™¯1: ç®€å•æ¨¡ç³Šæœç´¢
- **å‰ç½®æ¡ä»¶**: PDFåˆ—è¡¨æ˜¾ç¤ºè‡³å°‘20æ¡è®°å½•
- **æ“ä½œæ­¥éª¤**:
  1. åœ¨æœç´¢æ¡†è¾“å…¥"Python"
  2. ç­‰å¾…300msï¼ˆé˜²æŠ–ï¼‰
- **é¢„æœŸç»“æœ**:
  - è¡¨æ ¼åªæ˜¾ç¤ºæ–‡ä»¶åæˆ–æ ‡ç­¾åŒ…å«"Python"çš„è®°å½•
  - æ´»è·ƒæ¡ä»¶åŒºåŸŸæ˜¾ç¤º"æ¨¡ç³Šæœç´¢: Python"
  - ç»Ÿè®¡æ˜¾ç¤ºæ­£ç¡®çš„ç­›é€‰æ•°é‡

#### æµ‹è¯•åœºæ™¯2: å¤šå…³é”®è¯æœç´¢
- **å‰ç½®æ¡ä»¶**: PDFåˆ—è¡¨æ˜¾ç¤ºæ­£å¸¸
- **æ“ä½œæ­¥éª¤**:
  1. è¾“å…¥"Python æ•™ç¨‹"ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰
  2. ç­‰å¾…300ms
- **é¢„æœŸç»“æœ**:
  - æ˜¾ç¤ºåŒ…å«"Python"æˆ–"æ•™ç¨‹"çš„è®°å½•
  - åŒ¹é…ä»»ä¸€å…³é”®è¯å³å¯

#### æµ‹è¯•åœºæ™¯3: é«˜çº§ç­›é€‰ - å•æ¡ä»¶
- **å‰ç½®æ¡ä»¶**: ç‚¹å‡»"é«˜çº§"æŒ‰é’®
- **æ“ä½œæ­¥éª¤**:
  1. æ·»åŠ æ¡ä»¶ï¼šè¯„åˆ† â‰¥ 4
  2. ç‚¹å‡»"åº”ç”¨ç­›é€‰"
- **é¢„æœŸç»“æœ**:
  - åªæ˜¾ç¤ºè¯„åˆ†â‰¥4æ˜Ÿçš„PDF
  - æœç´¢æ¡†ä¸‹æ–¹æ˜¾ç¤ºæ¡ä»¶"rating â‰¥ 4"

#### æµ‹è¯•åœºæ™¯4: é«˜çº§ç­›é€‰ - ç»„åˆæ¡ä»¶
- **å‰ç½®æ¡ä»¶**: æ‰“å¼€é«˜çº§ç­›é€‰
- **æ“ä½œæ­¥éª¤**:
  1. æ·»åŠ æ¡ä»¶1ï¼šè¯„åˆ† â‰¥ 4
  2. æ·»åŠ æ¡ä»¶2ï¼šé€»è¾‘é€‰"ä¸”"ï¼Œå¤ä¹ æ¬¡æ•° > 10
  3. ç‚¹å‡»"åº”ç”¨ç­›é€‰"
- **é¢„æœŸç»“æœ**:
  - åªæ˜¾ç¤ºè¯„åˆ†â‰¥4ä¸”å¤ä¹ æ¬¡æ•°>10çš„PDF
  - æ¡ä»¶æè¿°ï¼š"(è¯„åˆ† â‰¥ 4 ä¸” å¤ä¹ æ¬¡æ•° > 10)"

#### æµ‹è¯•åœºæ™¯5: æ¸…é™¤ç­›é€‰
- **å‰ç½®æ¡ä»¶**: å·²åº”ç”¨ç­›é€‰æ¡ä»¶
- **æ“ä½œæ­¥éª¤**:
  1. ç‚¹å‡»æŸä¸ªæ¡ä»¶chipçš„"Ã—"æŒ‰é’®
  2. è§‚å¯Ÿè¡¨æ ¼å˜åŒ–
- **é¢„æœŸç»“æœ**:
  - è¯¥æ¡ä»¶è¢«ç§»é™¤
  - è¡¨æ ¼é‡æ–°ç­›é€‰
  - å¦‚æœæ‰€æœ‰æ¡ä»¶éƒ½è¢«ç§»é™¤ï¼Œæ˜¾ç¤ºå…¨éƒ¨è®°å½•

#### æµ‹è¯•åœºæ™¯6: ä¸€é”®æ¸…é™¤å…¨éƒ¨
- **å‰ç½®æ¡ä»¶**: å·²åº”ç”¨å¤šä¸ªç­›é€‰æ¡ä»¶
- **æ“ä½œæ­¥éª¤**:
  1. ç‚¹å‡»"æ¸…é™¤å…¨éƒ¨"æŒ‰é’®
- **é¢„æœŸç»“æœ**:
  - æ‰€æœ‰æ¡ä»¶è¢«æ¸…é™¤
  - è¡¨æ ¼æ˜¾ç¤ºå…¨éƒ¨è®°å½•
  - æœç´¢æ¡†æ¸…ç©º
  - ç»Ÿè®¡æ¶ˆå¤±

#### æµ‹è¯•åœºæ™¯7: å­—ç¬¦ä¸²å­—æ®µç­›é€‰
- **å‰ç½®æ¡ä»¶**: æ‰“å¼€é«˜çº§ç­›é€‰
- **æ“ä½œæ­¥éª¤**:
  1. å­—æ®µé€‰"æ–‡ä»¶å"
  2. æ“ä½œç¬¦é€‰"åŒ…å«"
  3. å€¼è¾“å…¥"tutorial"
  4. åº”ç”¨ç­›é€‰
- **é¢„æœŸç»“æœ**:
  - åªæ˜¾ç¤ºæ–‡ä»¶ååŒ…å«"tutorial"çš„PDFï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰

#### æµ‹è¯•åœºæ™¯8: æ•°å­—å­—æ®µç­›é€‰
- **å‰ç½®æ¡ä»¶**: æ‰“å¼€é«˜çº§ç­›é€‰
- **æ“ä½œæ­¥éª¤**:
  1. å­—æ®µé€‰"å¤ä¹ æ¬¡æ•°"
  2. æ“ä½œç¬¦é€‰"å¤§äº"
  3. å€¼è¾“å…¥"5"
  4. åº”ç”¨ç­›é€‰
- **é¢„æœŸç»“æœ**:
  - åªæ˜¾ç¤ºå¤ä¹ æ¬¡æ•°>5çš„PDF
  - æ•°å­—æ­£ç¡®æ¯”è¾ƒï¼ˆä¸æ˜¯å­—ç¬¦ä¸²æ¯”è¾ƒï¼‰

#### æµ‹è¯•åœºæ™¯9: é€»è¾‘ç»„åˆ - OR
- **å‰ç½®æ¡ä»¶**: æ‰“å¼€é«˜çº§ç­›é€‰
- **æ“ä½œæ­¥éª¤**:
  1. æ¡ä»¶1ï¼šè¯„åˆ† â‰¥ 4
  2. æ¡ä»¶2ï¼šé€»è¾‘é€‰"æˆ–"ï¼Œå¤ä¹ æ¬¡æ•° > 20
  3. åº”ç”¨ç­›é€‰
- **é¢„æœŸç»“æœ**:
  - æ˜¾ç¤ºè¯„åˆ†â‰¥4æˆ–å¤ä¹ æ¬¡æ•°>20çš„PDFï¼ˆæ»¡è¶³ä»»ä¸€æ¡ä»¶å³å¯ï¼‰

#### æµ‹è¯•åœºæ™¯10: æ€§èƒ½æµ‹è¯•
- **å‰ç½®æ¡ä»¶**: åŠ è½½1000æ¡PDFè®°å½•
- **æ“ä½œæ­¥éª¤**:
  1. åœ¨æœç´¢æ¡†è¾“å…¥å…³é”®è¯
  2. æµ‹é‡å“åº”æ—¶é—´
- **é¢„æœŸç»“æœ**:
  - ç­›é€‰å®Œæˆæ—¶é—´ < 500ms
  - UIä¸å¡é¡¿ï¼Œæµç•…å“åº”

### æ¥å£å®ç°

#### æ¥å£1: IFilterCondition.match()
- **å‡½æ•°**: `match(record)`
- **æè¿°**: åˆ¤æ–­è®°å½•æ˜¯å¦åŒ¹é…æ¡ä»¶
- **å‚æ•°**:
  - `record`: Object - PDFè®°å½•å¯¹è±¡
- **è¿”å›å€¼**: boolean - æ˜¯å¦åŒ¹é…
- **å¼‚å¸¸**: è‹¥è®°å½•æ ¼å¼é”™è¯¯ï¼Œè¿”å›false

#### æ¥å£2: FilterManager.addCondition()
- **å‡½æ•°**: `addCondition(condition)`
- **æè¿°**: æ·»åŠ ç­›é€‰æ¡ä»¶å¹¶åº”ç”¨
- **å‚æ•°**:
  - `condition`: IFilterCondition - æ¡ä»¶å®ä¾‹
- **è¿”å›å€¼**: void
- **äº‹ä»¶è§¦å‘**: `filter:condition-added`

#### æ¥å£3: FilterManager.applyFilters()
- **å‡½æ•°**: `applyFilters()`
- **æè¿°**: åº”ç”¨æ‰€æœ‰æ´»è·ƒæ¡ä»¶è¿›è¡Œç­›é€‰
- **å‚æ•°**: æ— 
- **è¿”å›å€¼**: Array - ç­›é€‰åçš„æ•°æ®
- **äº‹ä»¶è§¦å‘**: `filter:applied`

#### æ¥å£4: FilterBuilder.applyFilter()
- **å‡½æ•°**: `applyFilter()`
- **æè¿°**: åº”ç”¨æ„å»ºå™¨ä¸­é…ç½®çš„ç­›é€‰æ¡ä»¶
- **å‚æ•°**: æ— 
- **è¿”å›å€¼**: void
- **å‰¯ä½œç”¨**: æ›´æ–°FilterManagerï¼Œå…³é—­æ„å»ºå™¨

### ç±»å®ç°

#### ç±»1: IFilterCondition
- **ç±»**: `IFilterCondition`
- **æè¿°**: ç­›é€‰æ¡ä»¶æŠ½è±¡æ¥å£
- **æ–¹æ³•**:
  - `getConditionId()`: è·å–å”¯ä¸€æ ‡è¯†
  - `getConditionType()`: è·å–æ¡ä»¶ç±»å‹
  - `getDescription()`: è·å–å¯è¯»æè¿°
  - `match(record)`: æ‰§è¡ŒåŒ¹é…
  - `validate()`: éªŒè¯æ¡ä»¶
  - `serialize()`: åºåˆ—åŒ–
  - `deserialize(config)`: ååºåˆ—åŒ–
  - `clone()`: å…‹éš†æ¡ä»¶

#### ç±»2: FieldCondition
- **ç±»**: `FieldCondition extends IFilterCondition`
- **æè¿°**: å­—æ®µç­›é€‰æ¡ä»¶
- **å±æ€§**:
  - `field`: string - å­—æ®µå
  - `operator`: string - æ“ä½œç¬¦
  - `value`: any - ç­›é€‰å€¼
  - `dataType`: string - æ•°æ®ç±»å‹
- **æ–¹æ³•**: å®ç°æ‰€æœ‰æ¥å£æ–¹æ³•

#### ç±»3: FuzzySearchCondition
- **ç±»**: `FuzzySearchCondition extends IFilterCondition`
- **æè¿°**: æ¨¡ç³Šæœç´¢æ¡ä»¶
- **å±æ€§**:
  - `keywords`: string[] - å…³é”®è¯æ•°ç»„
  - `searchFields`: string[] - æœç´¢å­—æ®µ
  - `matchMode`: 'any' | 'all' - åŒ¹é…æ¨¡å¼
- **æ–¹æ³•**: å®ç°æ‰€æœ‰æ¥å£æ–¹æ³•
- **é™æ€æ–¹æ³•**: `parseKeywords(text)` - è§£æå…³é”®è¯

#### ç±»4: CompositeCondition
- **ç±»**: `CompositeCondition extends IFilterCondition`
- **æè¿°**: ç»„åˆæ¡ä»¶ï¼ˆæ”¯æŒé€»è¾‘è¿ç®—ï¼‰
- **å±æ€§**:
  - `operator`: 'AND' | 'OR' | 'NOT' - é€»è¾‘æ“ä½œç¬¦
  - `conditions`: IFilterCondition[] - å­æ¡ä»¶æ•°ç»„
- **æ–¹æ³•**:
  - å®ç°æ‰€æœ‰æ¥å£æ–¹æ³•
  - `addCondition(condition)`: æ·»åŠ å­æ¡ä»¶
  - `removeCondition(index)`: ç§»é™¤å­æ¡ä»¶

#### ç±»5: FilterManager
- **ç±»**: `FilterManager`
- **æè¿°**: ç­›é€‰åŠŸèƒ½çš„ä¸šåŠ¡åè°ƒå™¨
- **å±æ€§**:
  - `eventBus`: EventBus
  - `logger`: Logger
  - `activeConditions`: IFilterCondition[] - æ´»è·ƒæ¡ä»¶
  - `filterMode`: 'simple' | 'advanced'
  - `filteredData`: Array - ç­›é€‰ç»“æœ
  - `originalData`: Array - åŸå§‹æ•°æ®
- **æ–¹æ³•**:
  - `setDataSource(data)`: è®¾ç½®æ•°æ®æº
  - `addCondition(condition)`: æ·»åŠ æ¡ä»¶
  - `removeCondition(id)`: ç§»é™¤æ¡ä»¶
  - `clearAllConditions()`: æ¸…é™¤æ‰€æœ‰æ¡ä»¶
  - `applyFilters()`: åº”ç”¨ç­›é€‰
  - `getFilteredData()`: è·å–ç»“æœ
  - `exportFilterConfig()`: å¯¼å‡ºé…ç½®
  - `importFilterConfig(config)`: å¯¼å…¥é…ç½®

#### ç±»6: FilterSearchBar
- **ç±»**: `FilterSearchBar`
- **æè¿°**: ç­›é€‰æœç´¢æ¡†UIç»„ä»¶ï¼ˆç®€å•æ¨¡å¼ï¼‰
- **å±æ€§**:
  - `container`: HTMLElement
  - `searchInput`: HTMLInputElement
  - `searchTimeout`: number
- **æ–¹æ³•**:
  - `_createUI()`: åˆ›å»ºUI
  - `_performSearch(text)`: æ‰§è¡Œæœç´¢
  - `_updateActiveConditionsDisplay()`: æ›´æ–°æ¡ä»¶æ˜¾ç¤º
  - `_updateStatsDisplay()`: æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º

#### ç±»7: FilterBuilder
- **ç±»**: `FilterBuilder`
- **æè¿°**: é«˜çº§ç­›é€‰æ„å»ºå™¨UIç»„ä»¶
- **å±æ€§**:
  - `container`: HTMLElement
  - `conditionsList`: Array - æ¡ä»¶åˆ—è¡¨
- **æ–¹æ³•**:
  - `show()`: æ˜¾ç¤ºæ„å»ºå™¨
  - `hide()`: éšè—æ„å»ºå™¨
  - `addConditionRow(config)`: æ·»åŠ æ¡ä»¶è¡Œ
  - `removeConditionRow(id)`: ç§»é™¤æ¡ä»¶è¡Œ
  - `applyFilter()`: åº”ç”¨ç­›é€‰
  - `_renderConditions()`: æ¸²æŸ“æ¡ä»¶
  - `_buildCompositeCondition()`: æ„å»ºç»„åˆæ¡ä»¶
  - `_updatePreview()`: æ›´æ–°é¢„è§ˆ

### äº‹ä»¶è§„èŒƒ

#### äº‹ä»¶1: filter:condition-added
- **æè¿°**: æ·»åŠ ç­›é€‰æ¡ä»¶æ—¶è§¦å‘
- **è§¦å‘æ—¶æœº**: FilterManager.addCondition() æˆåŠŸå
- **å‚æ•°**:
  ```javascript
  {
    condition: {...},  // æ¡ä»¶åºåˆ—åŒ–å¯¹è±¡
    totalConditions: 2
  }
  ```
- **ç›‘å¬è€…**: FilterSearchBarï¼ˆæ›´æ–°UIï¼‰

#### äº‹ä»¶2: filter:condition-removed
- **æè¿°**: ç§»é™¤ç­›é€‰æ¡ä»¶æ—¶è§¦å‘
- **è§¦å‘æ—¶æœº**: FilterManager.removeCondition() æˆåŠŸå
- **å‚æ•°**:
  ```javascript
  {
    conditionId: 'field_filename_123',
    totalConditions: 1
  }
  ```
- **ç›‘å¬è€…**: FilterSearchBarï¼ˆæ›´æ–°UIï¼‰

#### äº‹ä»¶3: filter:all-cleared
- **æè¿°**: æ¸…é™¤æ‰€æœ‰ç­›é€‰æ¡ä»¶æ—¶è§¦å‘
- **è§¦å‘æ—¶æœº**: FilterManager.clearAllConditions() æ‰§è¡Œå
- **å‚æ•°**: æ— 
- **ç›‘å¬è€…**: FilterSearchBar, FilterBuilder

#### äº‹ä»¶4: filter:applied
- **æè¿°**: ç­›é€‰æ‰§è¡Œå®Œæˆæ—¶è§¦å‘
- **è§¦å‘æ—¶æœº**: FilterManager.applyFilters() å®Œæˆå
- **å‚æ•°**:
  ```javascript
  {
    totalRecords: 1000,
    filteredRecords: 45,
    conditions: [...]
  }
  ```
- **ç›‘å¬è€…**: FilterSearchBar, TableWrapper

#### äº‹ä»¶5: filter:show-advanced-builder
- **æè¿°**: è¯·æ±‚æ˜¾ç¤ºé«˜çº§ç­›é€‰æ„å»ºå™¨
- **è§¦å‘æ—¶æœº**: ç”¨æˆ·ç‚¹å‡»"é«˜çº§"æŒ‰é’®
- **å‚æ•°**: æ— 
- **ç›‘å¬è€…**: FilterBuilder

#### äº‹ä»¶6: filter:mode-changed
- **æè¿°**: ç­›é€‰æ¨¡å¼åˆ‡æ¢æ—¶è§¦å‘
- **è§¦å‘æ—¶æœº**: FilterManager.setFilterMode() æ‰§è¡Œå
- **å‚æ•°**:
  ```javascript
  {
    mode: 'simple' | 'advanced'
  }
  ```
- **ç›‘å¬è€…**: UIç»„ä»¶ï¼ˆè°ƒæ•´æ˜¾ç¤ºï¼‰

## æŠ€æœ¯ç»†èŠ‚

### CSS æ ·å¼è¦æ±‚
```css
/* ç­›é€‰æœç´¢æ¡† */
.filter-search-bar {
  padding: 16px;
  background: var(--bg-color, #fff);
  border-bottom: 1px solid var(--border-color, #e0e0e0);
}

.search-input-group {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  background: white;
}

.search-input-group:focus-within {
  border-color: #1976D2;
  box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.1);
}

.search-input {
  flex: 1;
  border: none;
  outline: none;
  font-size: 14px;
}

.btn-advanced {
  padding: 6px 12px;
  background: #F5F5F5;
  border: 1px solid #ddd;
  border-radius: 4px;
  cursor: pointer;
}

.btn-advanced:hover {
  background: #E0E0E0;
}

/* æ´»è·ƒæ¡ä»¶æ˜¾ç¤º */
.active-conditions {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 12px;
  padding: 8px;
  background: #F5F5F5;
  border-radius: 4px;
}

.condition-chip {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 8px;
  background: #E3F2FD;
  border-radius: 12px;
  font-size: 13px;
}

.condition-chip .btn-remove {
  border: none;
  background: transparent;
  color: #666;
  cursor: pointer;
  font-size: 16px;
  padding: 0 4px;
}

/* ç­›é€‰ç»“æœç»Ÿè®¡ */
.filter-stats {
  margin-top: 8px;
  font-size: 13px;
  color: #666;
}

/* é«˜çº§ç­›é€‰æ„å»ºå™¨ */
.filter-builder {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 2000;
}

.filter-builder-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
}

.filter-builder-dialog {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 700px;
  max-height: 80vh;
  background: white;
  border-radius: 8px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  display: flex;
  flex-direction: column;
}

.filter-builder-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid #e0e0e0;
}

.filter-builder-body {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
}

.condition-row {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 12px;
  padding: 12px;
  background: #F9F9F9;
  border-radius: 4px;
}

.condition-editor {
  display: flex;
  gap: 8px;
  align-items: center;
}

.field-select,
.operator-select {
  padding: 6px 8px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.value-input {
  flex: 1;
  padding: 6px 8px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.filter-builder-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-top: 1px solid #e0e0e0;
}

.preview {
  font-size: 13px;
  color: #666;
  max-width: 60%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
```

### æ€§èƒ½ä¼˜åŒ–

#### 1. é˜²æŠ–å¤„ç†
```javascript
// æœç´¢è¾“å…¥é˜²æŠ–ï¼Œé¿å…é¢‘ç¹ç­›é€‰
const DEBOUNCE_DELAY = 300;

let searchTimeout;
searchInput.addEventListener('input', (e) => {
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(() => {
    performSearch(e.target.value);
  }, DEBOUNCE_DELAY);
});
```

#### 2. å¤§æ•°æ®é‡ä¼˜åŒ–
```javascript
// è¶…è¿‡10000æ¡è®°å½•æ—¶ï¼Œä½¿ç”¨ Web Worker
if (data.length > 10000) {
  // åˆ›å»º Worker
  const worker = new Worker('filter-worker.js');

  worker.postMessage({
    data: data,
    conditions: conditions.map(c => c.serialize())
  });

  worker.onmessage = (e) => {
    const filteredData = e.data;
    updateTable(filteredData);
  };
} else {
  // ç›´æ¥åœ¨ä¸»çº¿ç¨‹ç­›é€‰
  const filteredData = applyFilters(data, conditions);
  updateTable(filteredData);
}
```

#### 3. ç»“æœç¼“å­˜
```javascript
// ç¼“å­˜æœ€è¿‘çš„ç­›é€‰ç»“æœ
class FilterCache {
  constructor(maxSize = 10) {
    this.cache = new Map();
    this.maxSize = maxSize;
  }

  get(key) {
    return this.cache.get(key);
  }

  set(key, value) {
    if (this.cache.size >= this.maxSize) {
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    this.cache.set(key, value);
  }

  generateKey(conditions) {
    return JSON.stringify(conditions.map(c => c.serialize()));
  }
}
```

### é”™è¯¯å¤„ç†

#### 1. æ¡ä»¶éªŒè¯é”™è¯¯
```javascript
try {
  filterManager.addCondition(condition);
} catch (error) {
  showErrorToast(`ç­›é€‰æ¡ä»¶æ— æ•ˆ: ${error.message}`);
  logger.error('[Filter] æ¡ä»¶éªŒè¯å¤±è´¥', error);
}
```

#### 2. æ•°æ®æ ¼å¼é”™è¯¯
```javascript
// å®¹é”™å¤„ç†ï¼šå¦‚æœè®°å½•ç¼ºå°‘å­—æ®µï¼Œè¿”å›falseè€Œä¸æ˜¯æŠ¥é”™
match(record) {
  try {
    const value = record[this.field];
    if (value === undefined) {
      return false;  // å­—æ®µä¸å­˜åœ¨ï¼Œä¸åŒ¹é…
    }
    // ... æ‰§è¡ŒåŒ¹é…é€»è¾‘
  } catch (error) {
    logger.warn('[Filter] åŒ¹é…è¿‡ç¨‹å‡ºé”™', error);
    return false;
  }
}
```

## æœªæ¥æ‰©å±•ç‚¹ (v002+)

### 1. æŸ¥è¯¢è¯­è¨€æ”¯æŒ
```javascript
// æ”¯æŒç±»ä¼¼ SQL çš„æŸ¥è¯¢è¯­æ³•
const query = 'filename:Python AND rating:>=4 OR tags:æ•™ç¨‹';
const conditions = FilterQueryParser.parse(query);
filterManager.importFilterConfig({ conditions });
```

### 2. æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒ
```javascript
// å­—æ®µæ¡ä»¶æ”¯æŒæ­£åˆ™
const regexCondition = new FieldCondition({
  field: 'filename',
  operator: 'regex',
  value: /^test_.*\.pdf$/i
});
```

### 3. ç­›é€‰æ¨¡æ¿ç®¡ç†
```javascript
// ä¿å­˜å¸¸ç”¨ç­›é€‰é…ç½®
class FilterTemplateManager {
  saveTemplate(name, config) {
    localStorage.setItem(`filter-template-${name}`, JSON.stringify(config));
  }

  loadTemplate(name) {
    const json = localStorage.getItem(`filter-template-${name}`);
    return json ? JSON.parse(json) : null;
  }

  listTemplates() {
    // è¿”å›æ‰€æœ‰æ¨¡æ¿
  }
}
```

### 4. æ™ºèƒ½ç­›é€‰å»ºè®®
```javascript
// åŸºäºå†å²ç­›é€‰ï¼Œæ¨èå¸¸ç”¨æ¡ä»¶
class FilterSuggestionEngine {
  analyzeHistory() {
    // åˆ†æç”¨æˆ·çš„ç­›é€‰å†å²
  }

  suggestConditions() {
    // æ¨èå¯èƒ½æœ‰ç”¨çš„ç­›é€‰æ¡ä»¶
    return [
      'è¯„åˆ† â‰¥ 4',
      'æœ€è¿‘7å¤©æ·»åŠ ',
      'æ ‡ç­¾åŒ…å« Python'
    ];
  }
}
```

### 5. åç«¯ç­›é€‰æ”¯æŒ
```javascript
// æœåŠ¡ç«¯åˆ†é¡µåœºæ™¯ï¼Œåœ¨åç«¯æ‰§è¡Œç­›é€‰
class BackendFilterExecutor {
  async applyFilters(conditions, page, pageSize) {
    const response = await fetch('/api/pdf/filter', {
      method: 'POST',
      body: JSON.stringify({
        conditions: conditions.map(c => c.serialize()),
        page,
        pageSize
      })
    });

    return response.json();
  }
}
```

## å¼€å‘é¡ºåºå»ºè®®

### Phase 1: æ ¸å¿ƒæ¶æ„ (1.5å¤©)
1. å®ç° `IFilterCondition` æ¥å£
2. å®ç° `FieldCondition`ã€`FuzzySearchCondition`ã€`CompositeCondition`
3. å®ç° `FilterConditionFactory`
4. å®ç° `FilterManager` æ ¸å¿ƒé€»è¾‘
5. ç¼–å†™å•å…ƒæµ‹è¯•

### Phase 2: ç®€å•æœç´¢ UI (1å¤©)
1. å®ç° `FilterSearchBar` ç»„ä»¶
2. å®ç°æ¨¡ç³Šæœç´¢åŠŸèƒ½
3. å®ç°æ¡ä»¶chipæ˜¾ç¤º
4. å®ç°ç»Ÿè®¡æ˜¾ç¤º
5. æµ‹è¯•æœç´¢äº¤äº’

### Phase 3: é«˜çº§ç­›é€‰ UI (2å¤©)
1. å®ç° `FilterBuilder` ç»„ä»¶
2. å®ç°æ¡ä»¶è¡ŒåŠ¨æ€æ·»åŠ /åˆ é™¤
3. å®ç°å­—æ®µ/æ“ä½œç¬¦/å€¼çš„è”åŠ¨
4. å®ç°é¢„è§ˆå’Œåº”ç”¨åŠŸèƒ½
5. æµ‹è¯•å¤æ‚åœºæ™¯

### Phase 4: é›†æˆå’Œä¼˜åŒ– (1å¤©)
1. é›†æˆåˆ° pdf-home ä¸»åº”ç”¨
2. ä¸ Tabulator è¡¨æ ¼å¯¹æ¥
3. æ€§èƒ½ä¼˜åŒ–ï¼ˆé˜²æŠ–ã€ç¼“å­˜ï¼‰
4. ç«¯åˆ°ç«¯æµ‹è¯•

### Phase 5: æ–‡æ¡£å’Œå®Œå–„ (0.5å¤©)
1. ç¼–å†™ä½¿ç”¨æ–‡æ¡£
2. æ·»åŠ ç¤ºä¾‹å’Œæ•™ç¨‹
3. ä»£ç å®¡æŸ¥
4. æœ€ç»ˆéªŒæ”¶

## é£é™©è¯„ä¼°

### é«˜é£é™©é¡¹
1. **å¤æ‚é€»è¾‘ç»„åˆçš„æ­£ç¡®æ€§**:
   - é£é™©: ANDã€ORã€NOT ç»„åˆå¯èƒ½å‡ºç°é€»è¾‘é”™è¯¯
   - ç¼“è§£: å……åˆ†çš„å•å…ƒæµ‹è¯•ï¼Œè¦†ç›–å„ç§ç»„åˆ

2. **å¤§æ•°æ®é‡æ€§èƒ½**:
   - é£é™©: 10000+æ¡è®°å½•ç­›é€‰å¯èƒ½å¡é¡¿
   - ç¼“è§£: Web Workerã€ç¼“å­˜ã€ä¼˜åŒ–ç®—æ³•

### ä¸­é£é™©é¡¹
1. **UIå¤æ‚åº¦**:
   - é£é™©: é«˜çº§ç­›é€‰æ„å»ºå™¨äº¤äº’å¤æ‚
   - ç¼“è§£: æ¸è¿›å¼å®ç°ï¼Œå…ˆç®€å•åå¤æ‚

2. **ç”¨æˆ·å­¦ä¹ æˆæœ¬**:
   - é£é™©: ç”¨æˆ·ä¸ä¼šä½¿ç”¨é«˜çº§åŠŸèƒ½
   - ç¼“è§£: æä¾›ç¤ºä¾‹ã€æç¤ºã€æ•™ç¨‹

## æˆåŠŸåº¦é‡æ ‡å‡†
- ç®€å•æœç´¢å“åº”æ—¶é—´ < 300msï¼ˆ1000æ¡è®°å½•ï¼‰
- é«˜çº§ç­›é€‰æ„å»ºå™¨æ˜“ç”¨æ€§è¯„åˆ† â‰¥ 8/10
- ç­›é€‰æ­£ç¡®ç‡ 100%ï¼ˆå•å…ƒæµ‹è¯•éªŒè¯ï¼‰
- æ”¯æŒè‡³å°‘10ç§æ“ä½œç¬¦
- æ”¯æŒè‡³å°‘3å±‚é€»è¾‘åµŒå¥—
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%
- ç”¨æˆ·æ»¡æ„åº¦ â‰¥ 8/10

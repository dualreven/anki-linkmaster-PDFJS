{
  "self-desc": "PDF查看器模块规范头文件",
  "version": "1.2",
  "changelog": [
    {
      "version": "1.2",
      "date": "2025-08-31",
      "changes": [
        "添加 Vite 开发与调试规范 (PDF-VIEWER-VITE-INTEGRATION-001)",
        "增强 WebSocket 消息契约与可靠性规范 (PDF-VIEWER-WEBSOCKET-CONTRACT-001)",
        "完善 QtWebEngine 适配规范的具体要求 (PDF-VIEWER-QTWEBENGINE-ADAPTATION-001)",
        "补充 PDF.js 集成与性能策略 (PDF-VIEWER-PDFJS-INTEGRATION-001)",
        "添加测试计划规范 (PDF-VIEWER-TEST-PLAN-001)",
        "为所有私有规范添加验收标准",
        "更新引用路径确保指向最新文件"
      ],
      "responsible": "agent-master"
    },
    {
      "version": "1.1",
      "date": "2025-08-31",
      "changes": [
        "从 YAML 格式转换为 JSON 格式",
        "添加 Common 组件复用规范引用",
        "添加测试相关规范引用",
        "版本号从 1.0 更新为 1.1"
      ],
      "responsible": "agent-master"
    }
  ],
  "ref": [
    {
      "path": "[根目录]/docs/SPEC/",
      "specs": [
        {
          "id": "FRONTEND-EVENT-BUS-001",
          "desc": "前端事件总线使用规范"
        },
        {
          "id": "FRONTEND-EVENT-NAMING-001",
          "desc": "前端事件命名规范"
        },
        {
         "id": "JAVASCRIPT-CLASS-STRUCTURE-001",
          "desc": "JavaScript类结构规范"
        },
        {
          "id": "JAVASCRIPT-FUNCTION-DESIGN-001",
          "desc": "JavaScript函数设计规范"
        },
        {
          "id": "JAVASCRIPT-NAMING-CONVENTION-001",
          "desc": "JavaScript命名规范"
        },
        {
          "id": "COMMON-LIBRARY-REUSE-001",
          "desc": "Common库工具复用规范"
        },
        {
          "id": "WEBSOCKET-REUSE-001",
          "desc": "WebSocket通信复用规范"
        },
        {
          "id": "FRONTEND-TEST-CONSOLE-LOGGING-001",
          "desc": "前端控制台调试规范"
        },
        {
          "id": "FRONTEND-TEST-DEBUGGING-001",
          "desc": "前端调试指南规范"
        },
        {
          "id": "TEST-EXECUTION-TYPES-001",
          "desc": "测试类型规范"
        },
        {
          "id": "TEST-EXECUTION-METHODS-001",
          "desc": "测试方法规范"
        },
        {
          "id": "TEST-OUTPUT-FORMAT-001",
          "desc": "测试输出格式规范"
        }
      ]
    }
  ],
  "private": [
    {
      "id": "PDF-VIEWER-STRUCTURE-001",
      "desc": "PDF查看器模块结构规范",
      "acceptance_criteria": [
        "模块结构清晰，符合单一职责原则",
        "所有组件和类都有明确的职责定义",
        "代码组织便于维护和扩展"
      ]
    },
    {
      "id": "PDF-VIEWER-EVENT-HANDLING-001",
      "desc": "PDF查看器事件处理规范",
      "acceptance_criteria": [
        "事件处理逻辑正确，无内存泄漏",
        "事件命名符合 FRONTEND-EVENT-NAMING-001 规范",
        "事件总线使用符合 FRONTEND-EVENT-BUS-001 规范"
      ]
    },
    {
      "id": "PDF-VIEWER-PDFJS-INTEGRATION-001",
      "desc": "PDF.js集成规范，包括推荐的PDF.js版本、worker线程配置、大文件处理策略、错误降级机制以及与QtWebEngine的兼容性",
      "acceptance_criteria": [
        "在Qt 5.15和Qt6.5环境下，打开100MB PDF文件不崩溃且在5秒内渲染首屏",
        "支持逐页懒加载和缩略图策略",
        "在内存受限时能优雅降级或提示用户",
        "与QtWebEngine无已知兼容性问题"
      ]
    },
    {
      "id": "PDF-VIEWER-QTWEBENGINE-ADAPTATION-001",
      "desc": "QtWebEngine适配规范，包括webPreferences配置、preload IPC注入、远程调试端口启用、用户代理处理、字体/打印差异以及版本兼容性",
      "acceptance_criteria": [
        "在QtWebEngine上正确配置contextIsolation、nodeIntegration等webPreferences",
        "通过preload脚本实现安全IPC通信",
        "能启用remote-debugging-port并进行调试",
        "处理不同Qt版本的兼容性，有回退策略"
      ]
    },
    {
      "id": "PDF-VIEWER-VITE-INTEGRATION-001",
      "desc": "Vite开发与调试规范，包括开发服务器配置、sourceMap策略、环境变量约定、热重载行为、QtWebEngine远程调试以及CI/本地调试步骤",
      "acceptance_criteria": [
        "开发服务器正确配置端口、主机和WebSocket代理",
        "sourceMap启用便于调试",
        "热重载在开发环境中工作正常",
        "能在QtWebEngine中启用远程调试并与Vite联动"
      ]
    },
    {
      "id": "PDF-VIEWER-WEBSOCKET-CONTRACT-001",
      "desc": "WebSocket消息契约与可靠性规范，包括消息格式、trace/request_id、心跳机制、重连策略、幂等性、错误码、负载策略、安全示例和测试用例",
      "acceptance_criteria": [
        "WebSocket在断线后3次重连内可恢复，且请求不重复处理",
        "消息格式符合JSON schema，包含必要元数据",
        "心跳和超时机制工作正常",
        "错误处理统一，有明确的错误码"
      ]
    },
    {
      "id": "PDF-VIEWER-TEST-PLAN-001",
      "desc": "PDF查看器测试计划规范，包括测试类型、覆盖要求、调试步骤、CI指令、mock策略和日志收集",
      "acceptance_criteria": [
        "单元测试覆盖核心功能，覆盖率不低于80%",
        "集成测试覆盖模块间交互",
        "端到端测试模拟真实用户场景",
        "测试日志通过[TEST]前缀可监控，并作为CI失败判据"
      ]
    }
  ]
}
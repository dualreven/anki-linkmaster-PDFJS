<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç¼–è¾‘æŒ‰é’®è°ƒè¯•</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-section {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .debug-section h3 {
            margin-top: 0;
            color: #333;
        }
        .status-ok {
            color: green;
            font-weight: bold;
        }
        .status-error {
            color: red;
            font-weight: bold;
        }
        .code {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 3px;
            margin: 5px 0;
            font-size: 12px;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            cursor: pointer;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <h1>ğŸ” PDFç¼–è¾‘æŒ‰é’®è°ƒè¯•å·¥å…·</h1>

    <div class="debug-section">
        <h3>1. æ£€æŸ¥å…¨å±€åº”ç”¨å¯¹è±¡</h3>
        <button onclick="checkApp()">æ£€æŸ¥ window.app</button>
        <div id="app-check"></div>
    </div>

    <div class="debug-section">
        <h3>2. æ£€æŸ¥åŠŸèƒ½åŸŸæ³¨å†Œ</h3>
        <button onclick="checkFeatures()">æ£€æŸ¥åŠŸèƒ½åŸŸ</button>
        <div id="features-check"></div>
    </div>

    <div class="debug-section">
        <h3>3. æ£€æŸ¥ç¼–è¾‘æŒ‰é’®</h3>
        <button onclick="checkEditButton()">æ£€æŸ¥æŒ‰é’®å…ƒç´ </button>
        <div id="button-check"></div>
    </div>

    <div class="debug-section">
        <h3>4. æ£€æŸ¥çŠ¶æ€ç®¡ç†å™¨</h3>
        <button onclick="checkStateManager()">æ£€æŸ¥StateManager</button>
        <div id="state-check"></div>
    </div>

    <div class="debug-section">
        <h3>5. æ‰‹åŠ¨ç»‘å®šæµ‹è¯•</h3>
        <button onclick="manualBindTest()">æ‰‹åŠ¨ç»‘å®šäº‹ä»¶</button>
        <div id="manual-check"></div>
    </div>

    <div class="debug-section">
        <h3>6. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—</h3>
        <div class="code">
            è¯·åœ¨æµè§ˆå™¨æ§åˆ¶å°(F12)è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
            <br><br>
            // æ£€æŸ¥pdf-editåŠŸèƒ½åŸŸæ˜¯å¦å®‰è£…<br>
            window.app?.getState()?.features?.installed
            <br><br>
            // æ£€æŸ¥ç¼–è¾‘æŒ‰é’®æ˜¯å¦å­˜åœ¨<br>
            document.getElementById('edit-pdf-btn')
            <br><br>
            // æ£€æŸ¥StateManager<br>
            window.app?.getStateManager()?.getState('pdf-list')
        </div>
    </div>

    <script type="module">
        window.checkApp = function() {
            const div = document.getElementById('app-check');
            if (!window.app) {
                div.innerHTML = '<span class="status-error">âŒ window.app ä¸å­˜åœ¨</span>';
                return;
            }

            div.innerHTML = `
                <span class="status-ok">âœ… window.app å­˜åœ¨</span>
                <div class="code">
                    ç‰ˆæœ¬: ${window.app.getState?.()?.version || 'unknown'}<br>
                    çŠ¶æ€: ${window.app.getState?.()?.status || 'unknown'}<br>
                    æ¶æ„: ${window.app.getState?.()?.architecture || 'unknown'}
                </div>
            `;
        };

        window.checkFeatures = function() {
            const div = document.getElementById('features-check');
            if (!window.app) {
                div.innerHTML = '<span class="status-error">âŒ window.app ä¸å­˜åœ¨</span>';
                return;
            }

            const state = window.app.getState();
            const registered = state?.features?.registered || [];
            const installed = state?.features?.installed || [];

            div.innerHTML = `
                <div class="code">
                    å·²æ³¨å†Œ: ${registered.join(', ')}<br>
                    å·²å®‰è£…: ${installed.join(', ')}<br>
                    <br>
                    pdf-edit æ³¨å†Œ: ${registered.includes('pdf-edit') ? 'âœ…' : 'âŒ'}<br>
                    pdf-edit å®‰è£…: ${installed.includes('pdf-edit') ? 'âœ…' : 'âŒ'}
                </div>
            `;
        };

        window.checkEditButton = function() {
            const div = document.getElementById('button-check');
            const btn = document.getElementById('edit-pdf-btn');

            if (!btn) {
                div.innerHTML = '<span class="status-error">âŒ æŒ‰é’®å…ƒç´ ä¸å­˜åœ¨</span>';
                return;
            }

            const listeners = getEventListeners?.(btn);

            div.innerHTML = `
                <span class="status-ok">âœ… æŒ‰é’®å…ƒç´ å­˜åœ¨</span>
                <div class="code">
                    ID: ${btn.id}<br>
                    ç±»å: ${btn.className}<br>
                    ç¦ç”¨çŠ¶æ€: ${btn.disabled}<br>
                    æ˜¾ç¤ºçŠ¶æ€: ${btn.style.display}<br>
                    ç‚¹å‡»äº‹ä»¶æ•°: ${listeners?.click?.length || 'æ— æ³•æ£€æµ‹(éœ€Chrome DevTools)'}
                </div>
            `;
        };

        window.checkStateManager = function() {
            const div = document.getElementById('state-check');

            if (!window.app) {
                div.innerHTML = '<span class="status-error">âŒ window.app ä¸å­˜åœ¨</span>';
                return;
            }

            const stateManager = window.app.getStateManager?.();
            if (!stateManager) {
                div.innerHTML = '<span class="status-error">âŒ StateManager ä¸å­˜åœ¨</span>';
                return;
            }

            const listState = stateManager.getState('pdf-list');

            div.innerHTML = `
                <span class="status-ok">âœ… StateManager å­˜åœ¨</span>
                <div class="code">
                    pdf-list çŠ¶æ€å­˜åœ¨: ${listState ? 'âœ…' : 'âŒ'}<br>
                    é€‰ä¸­ç´¢å¼•: ${JSON.stringify(listState?.selectedIndices || [])}<br>
                    æ€»æ¡ç›®æ•°: ${listState?.items?.length || 0}
                </div>
            `;
        };

        window.manualBindTest = function() {
            const div = document.getElementById('manual-check');
            const btn = document.getElementById('edit-pdf-btn');

            if (!btn) {
                div.innerHTML = '<span class="status-error">âŒ æŒ‰é’®ä¸å­˜åœ¨</span>';
                return;
            }

            // æ‰‹åŠ¨æ·»åŠ æµ‹è¯•äº‹ä»¶
            const testHandler = () => {
                alert('âœ… ç¼–è¾‘æŒ‰é’®ç‚¹å‡»äº‹ä»¶æ­£å¸¸å·¥ä½œï¼');
                console.log('[DEBUG] Edit button clicked');
            };

            btn.addEventListener('click', testHandler);

            div.innerHTML = `
                <span class="status-ok">âœ… å·²æ·»åŠ æµ‹è¯•äº‹ä»¶ç›‘å¬å™¨</span>
                <div class="code">
                    è¯·ç‚¹å‡»é¡µé¢ä¸Šçš„"âœï¸ ç¼–è¾‘"æŒ‰é’®ï¼Œå¦‚æœå¼¹å‡ºalertè¯´æ˜æŒ‰é’®å¯ä»¥å“åº”ç‚¹å‡»ã€‚
                    <br><br>
                    å¦‚æœæ²¡æœ‰å¼¹å‡ºï¼Œå¯èƒ½æ˜¯æŒ‰é’®è¢«CSSé®æŒ¡æˆ–disabledã€‚
                </div>
            `;
        };

        // é¡µé¢åŠ è½½åè‡ªåŠ¨è¿è¡Œæ£€æŸ¥
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                checkApp();
                checkFeatures();
                checkEditButton();
                checkStateManager();
            }, 1000);
        });
    </script>
</body>
</html>

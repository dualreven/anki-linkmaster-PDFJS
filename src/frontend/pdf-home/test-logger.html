<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>日志功能测试</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    .test-container {
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
    }
    button {
      padding: 8px 15px;
      margin-right: 10px;
      cursor: pointer;
    }
    #log-container {
      background-color: #f5f5f5;
      padding: 10px;
      height: 300px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: monospace;
    }
    .log-entry {
      margin-bottom: 5px;
      padding: 3px;
    }
    .log-debug { color: #6c757d; }
    .log-info { color: #0d6efd; }
    .log-warn { color: #fd7e14; }
    .log-error { color: #dc3545; }
  </style>
</head>
<body>
  <h1>日志功能测试</h1>
  
  <div class="test-container">
    <h2>基本日志测试</h2>
    <button id="log-debug">调试日志</button>
    <button id="log-info">信息日志</button>
    <button id="log-warn">警告日志</button>
    <button id="log-error">错误日志</button>
    <button id="clear-log">清除日志</button>
  </div>
  
  <div class="test-container">
    <h2>日志级别测试</h2>
    <button id="set-level-debug">设置级别为Debug</button>
    <button id="set-level-info">设置级别为Info</button>
    <button id="set-level-warn">设置级别为Warn</button>
    <button id="set-level-error">设置级别为Error</button>
    <button id="get-level">获取当前级别</button>
  </div>
  
  <div class="test-container">
    <h2>日志存储测试</h2>
    <button id="save-logs">保存日志到LocalStorage</button>
    <button id="load-logs">从LocalStorage加载日志</button>
    <button id="clear-storage">清除存储的日志</button>
  </div>
  
  <div class="test-container">
    <h2>日志输出</h2>
    <div id="log-container"></div>
  </div>
  
  <script type="module">
    import Logger, { LogLevel } from './utils/logger.js';
    
    // 创建日志实例
    const logger = new Logger('LoggerTest');
    
    // 日志容器
    const logContainer = document.getElementById('log-container');
    
    // 添加日志到容器
    function addLog(level, message) {
      const logEntry = document.createElement('div');
      logEntry.className = `log-entry log-${level}`;
      logEntry.textContent = `[${new Date().toLocaleTimeString()}] [${level.toUpperCase()}] ${message}`;
      logContainer.appendChild(logEntry);
      logContainer.scrollTop = logContainer.scrollHeight;
    }
    
    // 重写日志方法，使其输出到页面
    const originalDebug = logger.debug.bind(logger);
    const originalInfo = logger.info.bind(logger);
    const originalWarn = logger.warn.bind(logger);
    const originalError = logger.error.bind(logger);
    
    logger.debug = function(message) {
      originalDebug(message);
      addLog('debug', message);
    };
    
    logger.info = function(message) {
      originalInfo(message);
      addLog('info', message);
    };
    
    logger.warn = function(message) {
      originalWarn(message);
      addLog('warn', message);
    };
    
    logger.error = function(message) {
      originalError(message);
      addLog('error', message);
    };
    
    // 按钮事件处理
    document.getElementById('log-debug').addEventListener('click', () => {
      logger.debug('这是一条调试日志');
    });
    
    document.getElementById('log-info').addEventListener('click', () => {
      logger.info('这是一条信息日志');
    });
    
    document.getElementById('log-warn').addEventListener('click', () => {
      logger.warn('这是一条警告日志');
    });
    
    document.getElementById('log-error').addEventListener('click', () => {
      logger.error('这是一条错误日志');
    });
    
    document.getElementById('clear-log').addEventListener('click', () => {
      logContainer.innerHTML = '';
    });
    
    // 日志级别测试
    document.getElementById('set-level-debug').addEventListener('click', () => {
      logger.setLogLevel(LogLevel.DEBUG);
      logger.info('日志级别已设置为DEBUG');
    });
    
    document.getElementById('set-level-info').addEventListener('click', () => {
      logger.setLogLevel(LogLevel.INFO);
      logger.info('日志级别已设置为INFO');
    });
    
    document.getElementById('set-level-warn').addEventListener('click', () => {
      logger.setLogLevel(LogLevel.WARN);
      logger.info('日志级别已设置为WARN');
    });
    
    document.getElementById('set-level-error').addEventListener('click', () => {
      logger.setLogLevel(LogLevel.ERROR);
      logger.info('日志级别已设置为ERROR');
    });
    
    document.getElementById('get-level').addEventListener('click', () => {
      const level = logger.getLogLevel();
      logger.info(`当前日志级别: ${level}`);
    });
    
    // 日志存储测试
    document.getElementById('save-logs').addEventListener('click', () => {
      logger.info('日志已自动保存到LocalStorage');
    });
    
    document.getElementById('load-logs').addEventListener('click', () => {
      const logs = JSON.parse(localStorage.getItem('appLogs') || '[]');
      logger.info(`从LocalStorage加载了 ${logs.length} 条日志`);
      
      // 显示最近的5条日志
      logs.slice(-5).forEach(log => {
        addLog('info', `存储的日志: ${log}`);
      });
    });
    
    document.getElementById('clear-storage').addEventListener('click', () => {
      localStorage.removeItem('appLogs');
      logger.info('已清除LocalStorage中的日志');
    });
    
    // 初始化日志
    logger.info('日志功能测试页面已加载');
  </script>
</body>
</html>
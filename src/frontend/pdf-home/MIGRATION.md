# PDF-Home åŠŸèƒ½åŸŸæ¶æ„è¿ç§»è®¡åˆ’

## è¿ç§»ç­–ç•¥ï¼šæ¸è¿›å¼è¿ç§»

### æ ¸å¿ƒåŸåˆ™

1. **å‘åå…¼å®¹**ï¼šä¿æŒç°æœ‰ä»£ç æ­£å¸¸å·¥ä½œ
2. **æ¸è¿›å¼**ï¼šæ–°æ—§æ¶æ„å¹¶å­˜ï¼Œé€æ­¥è¿ç§»
3. **Feature Flag æ§åˆ¶**ï¼šé€šè¿‡é…ç½®åˆ‡æ¢æ–°æ—§æ¶æ„
4. **æœ€å°åŒ–ä¿®æ”¹**ï¼šä¸ç ´åç°æœ‰ä»£ç ï¼Œåªæ–°å¢æ–‡ä»¶

---

## ç°æœ‰æ¶æ„åˆ†æ

### å½“å‰æ–‡ä»¶ç»“æ„
```
pdf-home/
â”œâ”€â”€ index.js                    # å…¥å£æ–‡ä»¶
â”œâ”€â”€ bootstrap/
â”‚   â””â”€â”€ app-bootstrap.js       # åº”ç”¨å¯åŠ¨
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ pdf-home-app.js        # æ ¸å¿ƒåº”ç”¨ç±»
â”‚   â””â”€â”€ managers/              # ä¸“é—¨çš„ç®¡ç†å™¨
â”‚       â”œâ”€â”€ app-initialization-manager.js
â”‚       â”œâ”€â”€ table-configuration-manager.js
â”‚       â””â”€â”€ websocket-event-manager.js
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ ui-manager.js          # UI ç®¡ç†å™¨
â”‚   â””â”€â”€ handlers/              # å„ç§å¤„ç†å™¨
â”œâ”€â”€ table/
â”‚   â”œâ”€â”€ table-wrapper.js       # è¡¨æ ¼å°è£…
â”‚   â”œâ”€â”€ table-lifecycle-manager.js
â”‚   â””â”€â”€ table-data-handler.js
â””â”€â”€ container/
    â””â”€â”€ app-container.js       # æ—§çš„å®¹å™¨ï¼ˆå°†è¢«åºŸå¼ƒï¼‰
```

### å½“å‰å¯åŠ¨æµç¨‹
1. `index.js` â†’ `bootstrapPDFHomeApp()`
2. åˆ›å»º `PDFHomeApp` å®ä¾‹
3. åˆå§‹åŒ–å„ç§ç®¡ç†å™¨ï¼ˆç»„åˆæ¨¡å¼ï¼‰
4. è°ƒç”¨ `app.initialize()`
5. è®¾ç½® `window.app`

---

## æ–°æ¶æ„è®¾è®¡

### ç›®æ ‡æ–‡ä»¶ç»“æ„
```
pdf-home/
â”œâ”€â”€ index.js                    # å…¥å£æ–‡ä»¶ï¼ˆä¿æŒä¸å˜ï¼‰
â”œâ”€â”€ bootstrap/
â”‚   â”œâ”€â”€ app-bootstrap.js       # æ—§å¯åŠ¨ç¨‹åºï¼ˆä¿ç•™ï¼‰
â”‚   â””â”€â”€ app-bootstrap-v2.js    # æ–°å¯åŠ¨ç¨‹åºï¼ˆåŠŸèƒ½åŸŸæ¶æ„ï¼‰
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ pdf-home-app.js        # æ—§åº”ç”¨ç±»ï¼ˆä¿ç•™ï¼‰
â”‚   â”œâ”€â”€ pdf-home-app-v2.js     # æ–°åº”ç”¨ç±»ï¼ˆåŠŸèƒ½åŸŸæ¶æ„ï¼‰
â”‚   â”œâ”€â”€ dependency-container.js # æ–°å®¹å™¨ï¼ˆå·²å®ç°ï¼‰
â”‚   â”œâ”€â”€ feature-registry.js     # åŠŸèƒ½æ³¨å†Œä¸­å¿ƒï¼ˆå·²å®ç°ï¼‰
â”‚   â”œâ”€â”€ state-manager.js        # çŠ¶æ€ç®¡ç†å™¨ï¼ˆå·²å®ç°ï¼‰
â”‚   â””â”€â”€ feature-flag-manager.js # Feature Flagï¼ˆå·²å®ç°ï¼‰
â”œâ”€â”€ features/                   # åŠŸèƒ½åŸŸç›®å½•ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ pdf-list/              # PDF åˆ—è¡¨åŠŸèƒ½åŸŸ
â”‚   â”‚   â”œâ”€â”€ index.js           # åŠŸèƒ½å…¥å£ï¼ˆå·²å®ç°æ¡†æ¶ï¼‰
â”‚   â”‚   â”œâ”€â”€ feature.config.js  # åŠŸèƒ½é…ç½®
â”‚   â”‚   â”œâ”€â”€ components/        # UI ç»„ä»¶ï¼ˆè¿ç§»ç›®æ ‡ï¼‰
â”‚   â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘ï¼ˆè¿ç§»ç›®æ ‡ï¼‰
â”‚   â”‚   â””â”€â”€ state/             # çŠ¶æ€ç®¡ç†ï¼ˆè¿ç§»ç›®æ ‡ï¼‰
â”‚   â”œâ”€â”€ pdf-editor/            # PDF ç¼–è¾‘åŠŸèƒ½åŸŸ
â”‚   â””â”€â”€ pdf-sorter/            # PDF æ’åºåŠŸèƒ½åŸŸ
â””â”€â”€ config/
    â””â”€â”€ feature-flags.json     # Feature Flag é…ç½®
```

---

## è¿ç§»åˆ†é˜¶æ®µè®¡åˆ’

### é˜¶æ®µ 1: åŸºç¡€è®¾æ–½å‡†å¤‡ï¼ˆå·²å®Œæˆ âœ…ï¼‰
- âœ… DependencyContainer
- âœ… ScopedEventBus
- âœ… FeatureRegistry
- âœ… StateManager
- âœ… FeatureFlagManager
- âœ… åŠŸèƒ½åŸŸæ¡†æ¶ï¼ˆPDFListFeature, PDFEditorFeature, PDFSorterFeatureï¼‰

### é˜¶æ®µ 2: æ–°åº”ç”¨ç±»å®ç°ï¼ˆå½“å‰é˜¶æ®µï¼‰
**ç›®æ ‡**: åˆ›å»ºæ–°çš„å¯åŠ¨æµç¨‹ï¼Œä½¿åŠŸèƒ½åŸŸæ¶æ„å¯è¿è¡Œ

**ä»»åŠ¡**:
1. åˆ›å»º `PDFHomeAppV2` ç±»
2. åˆ›å»º `app-bootstrap-v2.js`
3. ä¿®æ”¹ `index.js` æ”¯æŒåŒæ¨¡å¼
4. åˆ›å»º Feature Flag é…ç½®æ–‡ä»¶

**æ–‡ä»¶æ¸…å•**:
- [ ] `core/pdf-home-app-v2.js` - æ–°åº”ç”¨ç±»
- [ ] `bootstrap/app-bootstrap-v2.js` - æ–°å¯åŠ¨ç¨‹åº
- [ ] `config/feature-flags.json` - Feature Flag é…ç½®
- [ ] ä¿®æ”¹ `index.js` - æ”¯æŒåŒæ¨¡å¼å¯åŠ¨

### é˜¶æ®µ 3: PDF åˆ—è¡¨åŠŸèƒ½è¿ç§»
**ç›®æ ‡**: å°† PDF åˆ—è¡¨ç›¸å…³ä»£ç è¿ç§»åˆ° PDFListFeature

**è¿ç§»å†…å®¹**:
- `table-wrapper.js` â†’ `features/pdf-list/components/pdf-table.js`
- `table-data-handler.js` â†’ `features/pdf-list/services/list-data-service.js`
- `table-lifecycle-manager.js` â†’ `features/pdf-list/services/list-lifecycle-service.js`
- è¡¨æ ¼é…ç½®é€»è¾‘ â†’ `features/pdf-list/state/list-state.js`

**å…³é”®ç‚¹**:
- ä½¿ç”¨ ScopedEventBus æ›¿ä»£å…¨å±€ EventBus
- ä½¿ç”¨ StateManager ç®¡ç†è¡¨æ ¼çŠ¶æ€
- äº‹ä»¶å‘½åï¼š`@pdf-list/table:row:selected` ç­‰

### é˜¶æ®µ 4: PDF ç¼–è¾‘åŠŸèƒ½è¿ç§»
**ç›®æ ‡**: å®ç° PDFEditorFeature çš„å®é™…åŠŸèƒ½

**è¿ç§»å†…å®¹**:
- åˆ›å»ºç¼–è¾‘æ¨¡æ€æ¡† UI
- å®ç°æ˜Ÿæ ‡ã€æ ‡ç­¾ã€å¤‡æ³¨ç¼–è¾‘
- é›†æˆåˆ° PDF åˆ—è¡¨ï¼ˆåŒå‡»æ‰“å¼€ç¼–è¾‘ï¼‰

### é˜¶æ®µ 5: WebSocket é›†æˆ
**ç›®æ ‡**: å°† WebSocket é€šä¿¡é›†æˆåˆ°åŠŸèƒ½åŸŸ

**ä»»åŠ¡**:
- WebSocketManager æ³¨å†Œåˆ° DependencyContainer
- åŠŸèƒ½åŸŸé€šè¿‡å®¹å™¨è·å– WebSocketManager
- ç»Ÿä¸€æ¶ˆæ¯åè®®

### é˜¶æ®µ 6: å®Œå…¨åˆ‡æ¢
**ç›®æ ‡**: ç§»é™¤æ—§ä»£ç ï¼Œå®Œå…¨ä½¿ç”¨æ–°æ¶æ„

**ä»»åŠ¡**:
- åˆ é™¤æ—§çš„ PDFHomeApp
- åˆ é™¤æ—§çš„ app-container.js
- æ›´æ–°æ–‡æ¡£

---

## è¿ç§»æ£€æŸ¥æ¸…å•

### åŠŸèƒ½å®Œæ•´æ€§
- [ ] PDF åˆ—è¡¨æ˜¾ç¤º
- [ ] PDF æ·»åŠ /åˆ é™¤
- [ ] PDF åŒå‡»æ‰“å¼€
- [ ] PDF å…ƒæ•°æ®ç¼–è¾‘
- [ ] PDF æ’åº
- [ ] PDF ç­›é€‰
- [ ] WebSocket é€šä¿¡
- [ ] é”™è¯¯å¤„ç†

### æ€§èƒ½è¦æ±‚
- [ ] åŠ è½½æ—¶é—´ < 500ms
- [ ] è¡¨æ ¼æ¸²æŸ“ < 100ms
- [ ] äº‹ä»¶å“åº” < 50ms
- [ ] å†…å­˜å ç”¨ä¸å¢åŠ  >20%

### æµ‹è¯•è¦†ç›–
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] é›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡
- [ ] æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•

---

## é£é™©å’Œç¼“è§£æªæ–½

### é£é™© 1: ç ´åç°æœ‰åŠŸèƒ½
**ç¼“è§£**: ä¿æŒæ—§ä»£ç ä¸åŠ¨ï¼Œæ–°ä»£ç é€šè¿‡ Feature Flag æ§åˆ¶

### é£é™© 2: æ€§èƒ½ä¸‹é™
**ç¼“è§£**: è¿›è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•ï¼Œå¯¹æ¯”æ–°æ—§æ¶æ„

### é£é™© 3: å­¦ä¹ æˆæœ¬
**ç¼“è§£**: ç¼–å†™è¯¦ç»†æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç 

### é£é™© 4: è¿ç§»æ—¶é—´è¿‡é•¿
**ç¼“è§£**: åˆ†é˜¶æ®µè¿ç§»ï¼Œæ¯ä¸ªé˜¶æ®µå¯ç‹¬ç«‹éªŒè¯

---

## å›æ»šè®¡åˆ’

å¦‚æœæ–°æ¶æ„å‡ºç°é—®é¢˜ï¼Œå¯ä»¥ï¼š
1. ä¿®æ”¹ Feature Flag é…ç½®ï¼Œç¦ç”¨æ–°æ¶æ„
2. é‡å¯åº”ç”¨ï¼Œè‡ªåŠ¨åˆ‡æ¢å›æ—§æ¶æ„
3. æ— éœ€é‡æ–°éƒ¨ç½²ä»£ç 

---

## å‚è€ƒæ–‡æ¡£

- [éœ€æ±‚è§„æ ¼è¯´æ˜](../../todo-and-doing/2%20todo/20251002130000-pdf-home-collaborative-architecture/v001-spec.md)
- [æ¶æ„é›†æˆæµ‹è¯•](__tests__/architecture-integration.test.js)
- [Feature Flag ç¤ºä¾‹é…ç½®](config/feature-flags.example.json)

---

**æœ€åæ›´æ–°**: 2025-10-02
**çŠ¶æ€**: ğŸš§ é˜¶æ®µ 2 è¿›è¡Œä¸­

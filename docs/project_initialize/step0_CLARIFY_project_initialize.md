# project_initialize 项目需求澄清文档

## 1. 背景与目标

### 1.1 项目背景
本项目是作为Anki插件LinkMaster的一个模块存在的，旨在替代基于PyMuPDF的旧版PDF阅读器。旧版本存在跨平台兼容性差、生态资源有限等问题，因此转向基于Web技术（PDF.js + PyQt6）的解决方案。

### 1.2 目标用户
- **主要用户**：学生、研究人员、需要进行PDF标注并反复学习思考的人群
- **使用场景**：深度PDF阅读、标注、制作Anki学习卡片

### 1.3 项目价值
- 利用Web技术丰富的生态资源
- 实现真正的跨平台兼容性（Windows/macOS/Linux）
- 为Anki用户提供更强大的PDF学习工具

## 2. 功能需求

### 2.1 第一阶段MVP功能

#### 2.1.1 PDF主页功能
- **文件管理**：
  - PDF文件列表展示
  - 单选/多选文件
  - 增加PDF文件
  - 删除PDF文件
  - 右键收藏功能
- **扩展性**：为后续功能预留开发接口

#### 2.1.2 PDF阅读器功能
- **核心阅读**：
  - 基于QtWebEngine + PDF.js实现PDF渲染
  - 支持书签加载
  - 支持文字层显示
  - 支持图像层显示
- **接口设计**：
  - 提供标准化API供PDF主页调用
  - 预留其他模块调用接口

### 2.2 未来功能规划（暂不实现）
- 标注功能（选框、选字、注释）
- Anki卡片制作功能
- 标注和卡片数据持久化
- 外部调用接口（从Anki跳转回PDF特定位置）
- Anki互通功能（复习时跳转、批量复习等）

## 3. 非功能需求

### 3.1 性能要求
- **优先级**：性能 > 生态丰富性
- **加载速度**：PDF文件列表和阅读器需要快速响应
- **内存使用**：避免内存泄漏，特别是在处理大型PDF时

### 3.2 兼容性要求
- **跨平台**：Windows、macOS、Linux
- **PyQt版本**：与Anki当前使用的PyQt6保持一致
- **浏览器兼容性**：基于QtWebEngine（Chromium内核）

### 3.3 用户体验
- 响应式UI设计
- 直观的文件管理界面
- 流畅的PDF阅读体验

## 4. 技术约束（已确认）

### 4.1 技术栈选择（最终确认）
- **后端框架**：PyQt6（与Anki版本保持一致）
- **前端技术**：
  - PDF渲染：PDF.js
  - 前端框架：Vanilla JS（ES6+现代语法）
  - 构建工具：Vite（用于开发时的模块化）
- **通信方式**：WebSocket
- **数据库**：SQLite
- **文件存储**：本地文件系统

### 4.2 架构约束
- **集成方式**：作为Python模块集成到现有Anki插件中
- **部署方式**：开发完成后将dist文件夹内容复制到Anki插件目录
- **同步机制**：利用Anki自带的同步功能

### 4.3 开发工具链
- **语言**：Python 3.9+（匹配Anki要求）
- **前端**：现代ES6+语法
- **构建工具**：Vite（开发用）
- **代码质量**：ESLint + Prettier
- **包管理**：npm/yarn

## 5. 项目结构规划

### 5.1 目录结构
```
anki-linkmaster-PDFJS/
├── src/
│   ├── backend/           # PyQt6后端代码
│   │   ├── main.py
│   │   ├── websocket_server.py
│   │   └── pdf_manager.py
│   ├── frontend/          # 前端代码
│   │   ├── pdf-home/      # PDF主页
│   │   ├── pdf-viewer/    # PDF阅读器
│   │   └── shared/        # 共享工具
│   └── assets/            # 静态资源
├── dist/                  # 构建输出（复制到Anki插件）
├── docs/                  # 项目文档
└── tests/                 # 测试文件
```

### 5.2 第一阶段开发重点
1. **项目初始化**：建立项目结构和开发环境
2. **PyQt6后端**：WebSocket服务器和PDF文件管理
3. **PDF主页**：Vanilla JS实现文件列表和管理
4. **PDF阅读器**：PDF.js集成和基础阅读功能
5. **通信机制**：前后端WebSocket通信

## 6. 已确认事项 ✅

- [x] 项目名称：anki-linkmaster-PDFJS
- [x] 技术栈：PyQt6 + Vanilla JS + PDF.js
- [x] 第一阶段功能范围
- [x] 集成方式：作为Python模块集成到Anki插件
- [x] 跨平台策略：Web技术实现跨平台
- [x] 前端技术选择：Vanilla JS（性能优先）

## 7. 下一步行动

项目已经具备开始开发的所有必要条件，建议立即开始：
1. 初始化项目结构
2. 配置开发环境
3. 创建基础PyQt6应用框架
4. 集成PDF.js到QtWebEngine
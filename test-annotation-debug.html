<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>æ ‡æ³¨UIè°ƒè¯•</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #f5f5f5;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    pre {
      background: #fff;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>ğŸ” æ ‡æ³¨UIæ¨¡å—åŠ è½½è¯Šæ–­</h1>
  <div id="output"></div>

  <script type="module">
    const output = document.getElementById('output');

    function log(message, type = 'info') {
      const div = document.createElement('div');
      div.className = `status ${type}`;
      div.innerHTML = message;
      output.appendChild(div);
    }

    function logError(message, error) {
      const div = document.createElement('div');
      div.className = 'status error';
      div.innerHTML = `
        <strong>${message}</strong><br>
        <pre>${error.message}\n${error.stack}</pre>
      `;
      output.appendChild(div);
    }

    // æµ‹è¯•å„ä¸ªæ¨¡å—çš„å¯¼å…¥
    async function testImports() {
      log('å¼€å§‹æµ‹è¯•æ¨¡å—å¯¼å…¥...', 'info');

      // 1. æµ‹è¯• EventBus
      try {
        const { EventBus } = await import('./src/frontend/common/event/event-bus.js');
        log('âœ… EventBus å¯¼å…¥æˆåŠŸ', 'success');
        const eventBus = new EventBus();
        log('âœ… EventBus å®ä¾‹åŒ–æˆåŠŸ', 'success');
        window.eventBus = eventBus;
      } catch (error) {
        logError('âŒ EventBus å¯¼å…¥å¤±è´¥', error);
        return;
      }

      // 2. æµ‹è¯• PDF_VIEWER_EVENTS
      try {
        const { PDF_VIEWER_EVENTS } = await import('./src/frontend/common/event/pdf-viewer-constants.js');
        log('âœ… PDF_VIEWER_EVENTS å¯¼å…¥æˆåŠŸ', 'success');
        log(`æ‰¾åˆ° ${Object.keys(PDF_VIEWER_EVENTS).length} ä¸ªäº‹ä»¶åˆ†ç±»`, 'info');
        if (PDF_VIEWER_EVENTS.ANNOTATION) {
          log('âœ… ANNOTATION äº‹ä»¶å­˜åœ¨', 'success');
          log(`ANNOTATION äº‹ä»¶æ•°: ${Object.keys(PDF_VIEWER_EVENTS.ANNOTATION).length}`, 'info');
        }
      } catch (error) {
        logError('âŒ PDF_VIEWER_EVENTS å¯¼å…¥å¤±è´¥', error);
        return;
      }

      // 3. æµ‹è¯• Annotation æ¨¡å‹
      try {
        const { Annotation, AnnotationType, HighlightColor } = await import('./src/frontend/pdf-viewer/features/annotation/models/annotation.js');
        log('âœ… Annotation æ¨¡å‹å¯¼å…¥æˆåŠŸ', 'success');

        // æµ‹è¯•åˆ›å»ºæ ‡æ³¨
        const testAnnotation = Annotation.createScreenshot(
          1,
          { x: 10, y: 10, width: 100, height: 100 },
          'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==',
          'æµ‹è¯•'
        );
        log('âœ… Annotation å®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
        log(`æ ‡æ³¨ID: ${testAnnotation.id}`, 'info');
      } catch (error) {
        logError('âŒ Annotation æ¨¡å‹å¯¼å…¥å¤±è´¥', error);
        return;
      }

      // 4. æµ‹è¯• Comment æ¨¡å‹
      try {
        const { Comment } = await import('./src/frontend/pdf-viewer/features/annotation/models/comment.js');
        log('âœ… Comment æ¨¡å‹å¯¼å…¥æˆåŠŸ', 'success');
      } catch (error) {
        logError('âŒ Comment æ¨¡å‹å¯¼å…¥å¤±è´¥', error);
        return;
      }

      // 5. æµ‹è¯• AnnotationSidebarUI
      try {
        const { AnnotationSidebarUI } = await import('./src/frontend/pdf-viewer/features/annotation/components/annotation-sidebar-ui.js');
        log('âœ… AnnotationSidebarUI å¯¼å…¥æˆåŠŸ', 'success');

        // åˆ›å»ºå®¹å™¨
        const container = document.createElement('main');
        container.style.cssText = 'position: relative; width: 100vw; height: 100vh;';
        document.body.appendChild(container);

        // å®ä¾‹åŒ–
        const sidebarUI = new AnnotationSidebarUI(window.eventBus, { container });
        log('âœ… AnnotationSidebarUI å®ä¾‹åŒ–æˆåŠŸ', 'success');

        // åˆå§‹åŒ–
        sidebarUI.initialize();
        log('âœ… AnnotationSidebarUI åˆå§‹åŒ–æˆåŠŸ', 'success');

        window.sidebarUI = sidebarUI;

        // æ˜¾ç¤ºä¾§è¾¹æ 
        setTimeout(() => {
          sidebarUI.show();
          log('âœ… ä¾§è¾¹æ å·²æ˜¾ç¤º', 'success');
        }, 500);

      } catch (error) {
        logError('âŒ AnnotationSidebarUI å¯¼å…¥æˆ–åˆå§‹åŒ–å¤±è´¥', error);
        return;
      }

      log('ğŸ‰ æ‰€æœ‰æ¨¡å—æµ‹è¯•é€šè¿‡ï¼', 'success');
      log('ğŸ’¡ æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹ window.eventBus å’Œ window.sidebarUI', 'info');
    }

    // æ‰§è¡Œæµ‹è¯•
    testImports().catch(error => {
      logError('æœªæ•è·çš„é”™è¯¯', error);
    });
  </script>
</body>
</html>

---
id: API-BACKEND-RESPONSE-001
title: "后端 API 响应格式规范"
version: 1.0
author: 
generated_time: 2025-08-27T00:00:00+08:00
source_inputs: 
  - [module]/spec-inputs/xxx.md
---

<!--
模板说明：
- 请将本文件另存为实际产物，文件名格式：`[范畴]-[子范畴]-[功能]-[序号ID].md`，例如：`API-BACKEND-RESPONSE-001.md`
- id 命名规则：大写英文字母组成的范畴-子范畴-功能-三位序号（001 开始），例如：API-BACKEND-RESPONSE-001
- version 为语义性递增：初始 1.0，向后兼容的小修使用 1.1、1.2；不兼容变更使用 2.0
- generated_time 由产出者填写，格式建议：YYYY-MM-DDThh:mm:ss+08:00（北京时间）
-->

# 原子规范（Atomic Spec）模板

> 文件示例名：`[范畴]-[子范畴]-[功能]-[序号ID].md`  
> 示例：`API-BACKEND-RESPONSE-001.md`

## 文件头（YAML metadata）示例与填写说明

在文件顶部保留 YAML metadata，供自动化工具识别。示例：

```yaml
id: API-BACKEND-RESPONSE-001
title: "后端 API 响应格式规范"
version: 1.0
author: "张三 <zhang@example.com>"
generated_time: 2025-08-27T12:00:00+08:00
source_inputs:
  - path: [`docs/spec-inputs/api-definitions.md`](docs/spec-inputs/api-definitions.md:1)
    note: "上游接口定义"
```

填写说明：
- id：必须唯一，格式为 `[范畴]-[子范畴]-[功能]-[序号]`，字母大写、短横分隔，序号三位从 `001` 开始递增。
- version：语义版本号（主版本.次版本），主版本变更表示不兼容修改。
- author：填写作者姓名和联系方式，便于变更追溯。
- generated_time：填写本次产出或更新的时间（北京时间，东八区）。
- source_inputs：列出所有上游输入文件的相对路径，建议使用相对路径并可点击。

## 1. 规范名称与描述（Name & Description）

- 规范名称：后端 API 响应格式规范
- 简短描述：定义后端 HTTP API 响应的通用包装结构、字段命名与错误处理格式，适用于服务间通信与外部 HTTP API。
- 问题与目的：统一响应结构，提高客户端解析一致性，便于监控与错误规范化。

## 2. 适用范围（Scope）

- 适用语言/模块：所有后端服务（例如：`service-a`, `service-b`）以及对外 HTTP API。  
- 场景示例：RESTful 接口响应、异步事件的同步响应封装。

## 3. 规范正文（Rules / Requirements）

以下规则应简洁、可验证：

3.1 响应总结构
- 必须返回 JSON 对象，顶层字段固定为 `code`, `message`, `data`, `meta`（`meta` 可选）。

3.2 字段定义
- `code`：整数，表示业务级返回码，0 表示成功，非 0 表示错误。范围建议：0（成功），1000-1999（客户端错误），2000-2999（服务端错误）。
- `message`：字符串，短文本描述错误或成功信息，不包含敏感信息。
- `data`：对象或数组，成功时返回实际数据；失败可为空对象或 `null`。
- `meta`（可选）：对象，包含分页、trace_id、timestamp 等辅助信息。

3.3 错误格式
- 错误响应 `code` 非 0，`data` 应包含 `error` 对象：{ "type", "detail", "instance" }。
- `error.type`：字符串，标准化错误类型（例如：ValidationError, NotFound）。
- `error.detail`：字符串或对象，包含人类可读的错误详情或字段级错误列表。
- `error.instance`：唯一错误实例 id（UUID 或 trace id），便于日志关联。

3.4 时间与时区
- 时间戳字段统一使用 ISO 8601 格式并带时区，例如 `2025-08-27T12:00:00+08:00`。

3.5 字段命名
- 采用 lower_snake_case 或 lowerCamelCase（团队需在本模板顶部声明选择）；跨团队必须一致。

3.6 HTTP 状态码约定
- 200 与 2xx：业务处理正常（code = 0 或业务成功码）；  
- 4xx：客户端请求问题，code 对应 1000-1999；  
- 5xx：服务端错误，code 对应 2000-2999。

3.7 可扩展性
- 新增字段应放在 `meta` 下或 `data` 子对象内，不得随意修改顶层语义字段含义。

## 4. 示例（Examples）

4.1 正向示例（成功响应）

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "user_id": 12345,
    "name": "Alice"
  },
  "meta": {
    "request_id": "req-20250827120000",
    "timestamp": "2025-08-27T12:00:00+08:00"
  }
}
```

4.2 反向示例（违反规范的响应，并注释问题）

```json
{
  "status": "ok",
  "payload": {
    "id": 123
  }
}
```

注：以上示例问题：
- 顶层未使用 `code`/`message`/`data` 结构（违反 3.1）。
- 字段命名不一致（`payload` 与约定的 `data` 不符）。

## 5. DoD 与测试点（Definition of Done / Test Points）

为每个关键规则提供可自动化验证的测试点：

- 规则 3.1 测试点：断言响应为 JSON，且存在顶层键 `code`,`message`,`data`。  
- 规则 3.2 测试点：断言 `code` 为整数且在允许范围内；`message` 为非空字符串。  
- 规则 3.3 测试点：当 `code` 非 0 时，`data.error` 存在且包含 `type` 与 `instance`。  
- 时间格式测试点：`meta.timestamp` 匹配正则 ISO 8601（含时区），例如使用 JSON Schema `format` 或正则。

示例 JSON Schema（片段，可用于 Spec-Verifier）：

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["code","message","data"],
  "properties": {
    "code": { "type": "integer" },
    "message": { "type": "string" },
    "data": {},
    "meta": {
      "type": "object",
      "properties": {
        "timestamp": { "type": "string", "format": "date-time" }
      }
    }
  }
}
```

## 6. 兼容性与迁移注意（Compatibility & Migration）

- 向后兼容变更：新增可选字段、扩展 `meta`，不改变现有字段语义。小版本（version.x）发布说明需列出新增字段与默认行为。
- 不兼容变更：更改 `code` 含义或移除顶层字段时，必须提升主版本（例如：1.x -> 2.0）并提供迁移指南。

迁移步骤示例：
1) 发布迁移公告并在 `SPEC-HEAD-[模块].yml` 中登记变更（示例路径见下文）。  
2) 在客户端/服务端并行支持旧/新结构一个兼容周期（例如：30 天）。  
3) 提供兼容层或转换插件，并在变更窗口结束后下线旧结构。

## 7. 参考与相关规范（References）

- 相关规范示例：[`templates/原子规范模板.md`](templates/原子规范模板.md:1)（本模板示例）  
- 依赖文档示例：[`docs/spec-inputs/api-definitions.md`](docs/spec-inputs/api-definitions.md:1)

## 8. 变更记录（Changelog）

- v1.0 | 2025-08-27 | 张三 | 初始版本：定义响应顶层结构与错误格式

变更记录模板：

| version | date | author | summary |
| ------- | ---- | ------ | ------- |
| 1.0 | 2025-08-27 | 作者 | 初始版本 |

## 9. 输出/保存位置建议（Location）

建议保存路径示例（相对项目根）：
- [`[模块]/docs/SPEC/[SPEC-ID].md`](.[module]/docs/SPEC/API-BACKEND-RESPONSE-001.md:1)  
示例：[`api/backend/docs/SPEC/API-BACKEND-RESPONSE-001.md`](api/backend/docs/SPEC/API-BACKEND-RESPONSE-001.md:1)

在 `SPEC-HEAD-[模块].yml` 中登记示例（示例片段）：

```yaml
specs:
  - id: API-BACKEND-RESPONSE-001
    path: [`api/backend/docs/SPEC/API-BACKEND-RESPONSE-001.md`](api/backend/docs/SPEC/API-BACKEND-RESPONSE-001.md:1)
    version: 1.0
```

## 填写示例（模板底部展示填写样例）

### YAML header 填写示例

```yaml
id: API-BACKEND-RESPONSE-001
title: "后端 API 响应格式规范"
version: 1.0
author: "李四 <li@example.com>"
generated_time: 2025-08-27T12:34:56+08:00
source_inputs:
  - path: [`docs/spec-inputs/api-definitions.md`](docs/spec-inputs/api-definitions.md:1)
```

### 填写示例：简短规范正文与示例

- 规范名称：后端 API 响应格式规范
- 描述：统一后端响应包装，便于客户端解析与监控。

示例成功响应：

```json
{
  "code": 0,
  "message": "success",
  "data": { "id": 1 }
}
```

DoD 对应测试点示例：
- D1: 自动化测试断言顶层存在 `code, message, data`（用例 id: dod-001）
- D2: 当返回错误时，`data.error.instance` 为 UUID 格式（用例 id: dod-002）

## 模板末尾示例：一个简短的原子规范（示例产物）

```yaml
id: API-BACKEND-RESPONSE-001
title: "后端 API 响应格式规范"
version: 1.0
author: "李四 <li@example.com>"
generated_time: 2025-08-27T12:34:56+08:00
source_inputs:
  - path: [`docs/spec-inputs/api-definitions.md`](docs/spec-inputs/api-definitions.md:1)
```

# 后端 API 响应格式规范

目的：统一后端 HTTP API 响应结构，提升客户端解析一致性。

规则（摘要）：
- 顶层必须包含 `code, message, data`。
- `code` 为整数，0 表示成功。

示例：

```json
{
  "code": 0,
  "message": "success",
  "data": {}
}
```

DoD：
- dod-001: 顶层键验证通过

Changelog:
- v1.0 | 2025-08-27 | 李四 | 初始简短规范

----

模板维护者：`团队规范小组`
联系方式：`specs@example.com`
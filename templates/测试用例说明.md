
---
title: 测试用例说明（模板）
author: Test-Designer
file_version: 1.0
input:
  - AITASK/[序号-项目名]/v[版本号]/[任务组别编号]/[YYYYMMDDhhmmss]-原子任务说明.md
  - AITASK/[序号-项目名]/v[版本号]/[任务组别编号]/[YYYYMMDDhhmmss]-API用例说明.md
usage: 为每个原子任务或接口提供可执行的测试用例描述、测试数据与执行步骤，供 Test-Verifier 使用
---

<!-- 本节说明测试用例说明的目的与适用范围 -->
# 概要

本文档为 AITASK 项目中“测试用例说明”的标准化模板。用于定义每个原子任务或接口的测试目标、测试范围、测试类型、可执行步骤、测试数据与验收标准。适用于 Test-Designer 编写、Test-Verifier 执行自动化/人工测试以及 CI/CD 集成。

<!-- 本节列出测试所需环境、数据、依赖与前提条件 -->
# 输入与前提

- 测试环境：
  - 操作系统/容器镜像：例如 Ubuntu 22.04 / python:3.11-slim
  - 必要服务：数据库（MySQL/Postgres）、缓存（Redis）、消息队列（RabbitMQ）等（视用例而定）
- 依赖文件/输入：
  - 上游任务产物、接口文档、API 用例说明等（见 YAML metadata input）
- 数据准备：预置用户账户、授权令牌（API Key/JWT）、初始化数据脚本
- 前置条件：目标服务可访问、依赖服务已启动、测试数据已加载

<!-- 本节用于快速概览哪些测试类型、优先级与适用场景 -->
# 测试用例矩阵（列出测试类型：单元/契约/集成/回归/验收）

| 测试类型 | 说明 | 优先级（示例） | 适用场景 |
| --- | --- | ---: | --- |
| 单元测试 | 验证单个函数/模块行为 | 高 | 代码逻辑验证 |
| 契约测试 | 服务间接口契约验证 | 高 | 微服务接口兼容性 |
| 集成测试 | 多组件联调 | 中 | 数据库/消息队列交互 |
| 回归测试 | 确保改动未引入缺陷 | 高 | 发布前回归 |
| 验收测试 | 功能验收与业务场景 | 中 | 用户场景验证 |

<!-- 本节给出单个用例的标准字段与填写示例，便于复制到测试管理系统 -->
# 单个用例模板

<!-- 本节说明测试用例模板的用途 -->

以下为单个用例的标准字段（复制进测试管理系统时请保持字段一致）：

| 用例ID | 名称 | 关联原子任务ID | 类型 | 前置条件 | 步骤 | 预期结果 | 测试数据 | 清理步骤 | 优先级 | 自动化可执行 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | ---: | --- |

<!-- 示例：正向用例 -->
| TC-001 | 创建用户（正向） | AT-20250827-001 | 集成 | 数据库可写、无重复用户 | 1. 调用 POST /api/users 创建用户 2. 验证返回 201 | 返回包含 user_id，数据库存在该用户 | {"username":"test_user","email":"test@example.com","password":"P@ssw0rd"} | 删除测试用户 | 高 | 是 |

<!-- 示例：负向用例 -->
| TC-002 | 创建用户（负向-缺少邮箱） | AT-20250827-001 | 集成 | 数据库可写 | 1. 调用 POST /api/users，body 省略 email 2. 验证返回 400 | 返回错误码及错误信息提示 email 必填 | {"username":"test_user2","password":"P@ssw0rd"} | 无特殊清理，确保未创建用户 | 中 | 是 |

<!-- 本节提供可复制的测试数据片段或链接 -->
# 测试数据与样例

<!-- 本节说明该部分用途 -->

- JSON 示例（可复制粘贴）
```json
{
  "create_user_positive": {
    "username": "test_user",
    "email": "test@example.com",
    "password": "P@ssw0rd"
  },
  "create_user_negative_missing_email": {
    "username": "test_user2",
    "password": "P@ssw0rd"
  }
}
```

- YAML 示例
```yaml
create_user_positive:
  username: test_user
  email: test@example.com
  password: P@ssw0rd
create_user_negative_missing_email:
  username: test_user2
  password: P@ssw0rd
```

<!-- 本节列出执行命令、依赖容器/工具、环境变量、CI/CD 示例命令 -->
# 自动化执行指引

<!-- 本节说明该部分用途 -->

下面提供本地、容器以及 CI/CD 级别的示例执行步骤与命令。

本地（使用 virtualenv / python）：
```bash
# 创建虚拟环境并安装依赖
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt pytest pytest-html
# 运行指定测试并生成报告
pytest tests/test_api_user.py::TestCreateUser --junitxml=reports/junit.xml --html=reports/report.html
```

容器（docker-compose）：
```bash
# 启动依赖服务
docker-compose -f docker-compose.test.yml up -d
# 运行测试容器（示例）
docker run --rm -v $(pwd):/app -w /app python:3.11-slim bash -c "pip install -r requirements.txt && pytest tests --junitxml=reports/junit.xml --html=reports/report.html"
# 清理
docker-compose -f docker-compose.test.yml down
```

CI/CD 示例（GitLab CI / GitHub Actions 粒度示例）：
```bash
# GitLab CI job snippet (示例)
test:
  image: python:3.11
  services:
    - name: postgres:14
  script:
    - pip install -r requirements.txt
    - pytest tests --junitxml=reports/junit.xml --html=reports/report.html
  artifacts:
    paths:
      - reports/
    when: always
```

测试报告位置示例：
- HTML 报告： reports/report.html
- JUnit XML： reports/junit.xml
- JSON（自定义）： reports/report.json

<!-- 本节定义通过/失败阈值，例如关键用例通过率或覆盖率目标 -->
# 覆盖与验收标准

<!-- 本节说明该部分用途 -->

- 关键用例（High）通过率目标： >= 95%
- 总体通过率目标： >= 90%
- 覆盖率目标（代码覆盖率）： 单元测试 >= 80%，集成测试情形覆盖关键路径 >= 70%

<!-- 本节描述失败时截图/日志收集规范与重试流程 -->
# 失败处理与重试策略

<!-- 本节说明该部分用途 -->

- 失败收集：
  - 自动化失败应收集以下产物（并上传至 CI job artifacts）：pytest 日志、截图（若 UI 测试）、系统日志、服务端错误堆栈与数据库快照（如适用）
- 重试策略：
  - 非确定性失败（环境抖动）可配置重试 1 次，记录重试日志并标注为 flaky
  - 功能失败需立即关闭 issue 并由开发定位修复

<!-- 本节说明测试报告路径、格式与包含项 -->
# 产物与报告

<!-- 本节说明该部分用途 -->

- 报告类型：
  - HTML 报告（人类可读）
  - JUnit XML（CI 集成）
  - JSON（用于自动化消费）
- 报告必须包含：
  - 用例执行摘要（通过/失败/跳过）
  - 失败用例的详细堆栈/日志/截图路径
  - 测试环境信息（镜像版本、依赖服务版本）

<!-- 本节记录版本/修改人/修改时间 -->
# 变更记录

<!-- 本节说明该部分用途 -->

| 版本 | 修改人 | 修改时间（YYYYMMDDhhmmss） | 变更说明 |
| --- | --- | --- | --- |
| 1.0 | Test-Designer | YYYYMMDDhhmmss | 初始模板 |

<!-- 本节以可点击相对路径列出引用的相关文档 -->
# 参考文档

<!-- 本节说明该部分用途 -->

- 请参考开发流程与项目结构：
  - [`docs/articles/开发流程设计.md`](docs/articles/开发流程设计.md:1)
  - [`docs/articles/A